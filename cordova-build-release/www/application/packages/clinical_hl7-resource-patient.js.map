{"version":3,"sources":["meteor://ðŸ’»app/packages/clinical:hl7-resource-patient/lib/Patients.js","meteor://ðŸ’»app/packages/clinical:hl7-resource-patient/index.jsx","meteor://ðŸ’»app/packages/clinical:hl7-resource-patient/client/react/PatientsPage.jsx"],"names":["module","export","Patient","Patients","PatientSchema","PatientStu3","PatientDstu2","get","link","v","validator","BaseModel","Mongo","SimpleSchema","BaseSchema","DomainResourceSchema","HumanNameSchema","IdentifierSchema","ContactPointSchema","AddressSchema","Package","console","log","extend","prototype","_collection","Collection","connection","_transform","document","type","String","defaultValue","optional","Array","Boolean","allowedValues","Date","autoValue","dateArray","date","value","field","split","CodeableConceptSchema","Number","AttachmentSchema","Object","Code","PeriodSchema","ReferenceSchema","attachSchema","toFhir","EJSON","stringify","name","findUserId","userId","process","env","TRACE","find","findOneUserId","findOne","findMrn","findByMrn","findByReference","input","inputString","patientId","includes","patient","_id","findByPhone","isMobilePhone","fetchBundle","query","parameters","callback","patientArray","map","id","_document","result","Bundle","generate","toMongo","originalPatient","mongoRecord","identifier","forEach","period","start","startArray","end","endArray","toStu3","patientJson","birthDate","deceasedBoolean","family","text","given","prepForUpdate","resourceType","telecom","address","contact","prepForFhirTransfer","moment","format","display","displayName","smartphone","telco","use","reference","extension","url","valueString","removeProtectedInfo","options","anonymizedName","push","anonymize","Anon","secretGiven","anonName","i","length","phone","ssn","SidebarElements","DynamicRoutes","PatientsPage","PatientTable","PatientsTable","PatientDetail","PatientCard","PatientTables","CardText","CardTitle","RaisedButton","Tab","Tabs","Glass","GlassCard","VerticalCanvas","FullPageCanvas","React","ReactMeteorData","ReactMixin","PropTypes","Meteor","Session","HTTP","defaultPatient","index","username","email","gender","setDefault","props","state","getMeteorData","data","style","opacity","tab","borderBottom","borderRight","tabIndex","patientSearchFilter","fhirVersion","selectedPatientId","paginationLimit","selectedPatient","selected","patients","fetch","blur","appbar","darkroom","NODE_ENV","onCancelUpsertPatient","context","set","onDeletePatient","remove","error","Bert","alert","reason","HipaaLogger","logEvent","eventType","userName","user","fullName","collectionName","recordId","onUpsertPatient","self","fhirPatientData","assign","patientValidator","newContext","validate","isValid","validationErrors","update","$set","insert","onTableRowClick","onTableCellClick","tableActionButtonClick","httpEndpoint","post","handleTabChange","onNewTab","render","version","handleActive","pagnationLimit","Component","exportDefault"],"mappings":"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","file":"/packages/clinical_hl7-resource-patient.js","sourcesContent":["import { get } from 'lodash';\nimport validator from 'validator';\n\nif(Package['clinical:autopublish']){\n  console.log(\"*****************************************************************************\")\n  console.log(\"HIPAA WARNING:  Your app has the 'clinical-autopublish' package installed.\");\n  console.log(\"Any protected health information (PHI) stored in this app should be audited.\"); \n  console.log(\"Please consider writing secure publish/subscribe functions and uninstalling.\");  \n  console.log(\"\");  \n  console.log(\"meteor remove clinical:autopublish\");  \n  console.log(\"\");  \n}\nif(Package['autopublish']){\n  console.log(\"*****************************************************************************\")\n  console.log(\"HIPAA WARNING:  DO NOT STORE PROTECTED HEALTH INFORMATION IN THIS APP. \");  \n  console.log(\"Your application has the 'autopublish' package installed.  Please uninstall.\");\n  console.log(\"\");  \n  console.log(\"meteor remove autopublish\");  \n  console.log(\"meteor add clinical:autopublish\");  \n  console.log(\"\");  \n}\n\n\nimport { BaseModel } from 'meteor/clinical:base-model';\nimport { Mongo } from 'meteor/mongo';\nimport SimpleSchema from 'simpl-schema';\nimport { BaseSchema, DomainResourceSchema, HumanNameSchema, IdentifierSchema, ContactPointSchema, AddressSchema } from 'meteor/clinical:hl7-resource-datatypes';\n\n\n\n// create the object using our BaseModel\nPatient = BaseModel.extend();\n\n\n//Assign a collection so the object knows how to perform CRUD operations\nPatient.prototype._collection = Patients;\n\n\n// // Create a persistent data store for addresses to be stored.\n// // HL7.Resources.Patients = new Mongo.Collection('HL7.Resources.Patients');\n\nif(typeof Patients === 'undefined'){\n  if(Package['clinical:autopublish']){\n    Patients = new Mongo.Collection('Patients');\n  } else if(Package['clinical:desktop-publish']){\n    Patients = new Mongo.Collection('Patients');\n  } else {\n    Patients = new Mongo.Collection('Patients', {connection: null});\n  }\n}\n\n\n//Add the transform to the collection since Meteor.users is pre-defined by the accounts package\nPatients._transform = function (document) {\n  return new Patient(document);\n};\n\n\n\n\nPatientDstu2 = new SimpleSchema({\n  \"resourceType\" : {\n    type: String,\n    defaultValue: \"Patient\"\n  },\n  \"identifier\" : {\n    optional: true,\n    type:  Array\n    },\n  \"identifier.$\" : {\n    optional: true,\n    type:  IdentifierSchema \n    },\n  \"active\" : {\n    type: Boolean,\n    optional: true,\n    defaultValue: true\n    },\n  \"name\" : {\n    optional: true,\n    type: Array\n    },\n  \"name.$\" : {\n    optional: true,\n    type: HumanNameSchema \n    },\n  \"telecom\" : {\n    optional: true,\n    type: Array\n    },\n  \"telecom.$\" : {\n    optional: true,\n    type: ContactPointSchema\n    },\n  \"gender\" : {\n    optional: true,\n    allowedValues: ['male', 'female', 'other', 'unknown'],\n    type: String\n    },\n  \"birthDate\" : {\n    optional: true,\n    type: String,\n  },\n  \"_birthDate\" : {\n      optional: true,\n      type: Date,\n      autoValue: function() {\n        var dateArray = [];\n        var date;\n        var value = this.field('birthDate').value;\n        if(typeof value === 'string'){\n          dateArray = value.split('-');\n          date = new Date(dateArray[0], dateArray[1] - 1, dateArray[2])\n        }\n        \n        if(date){\n          return date;\n        }\n      }\n    },\n  \"deceasedBoolean\" : {\n    optional: true,\n    type: Boolean\n    },\n  \"deceasedDateTime\" : {\n    optional: true,\n    type: Date\n    },\n  \"address\" : {\n    optional: true,\n    type: Array\n    },\n  \"address.$\" : {\n    optional: true,\n    type: AddressSchema \n    },\n  \"maritalStatus\" : {\n    optional: true,\n    type: CodeableConceptSchema\n    },\n  \"multipleBirthBoolean\" : {\n    optional: true,\n    type: Boolean\n    },\n  \"multipleBirthInteger\" : {\n    optional: true,\n    type: Number\n    },\n  \"photo\" : {\n    optional: true,\n    type: Array\n    },\n  \"photo.$\" : {\n    optional: true,\n    type: AttachmentSchema \n    },\n\n  \"contact\" : {\n    optional: true,\n    type:  Array\n    },\n  \"contact.$\" : {\n    optional: true,\n    type:  Object \n    },    \n  \"contact.$.relationship\" : {\n    optional: true,\n    type: Array\n    },\n  \"contact.$.relationship.$\" : {\n    optional: true,\n    type: CodeableConceptSchema \n    },\n  \"contact.$.name\" : {\n    optional: true,\n    type: HumanNameSchema\n    },\n  \"contact.$.telecom\" : {\n    optional: true,\n    type: Array\n    },\n  \"contact.$.telecom.$\" : {\n    optional: true,\n    type: ContactPointSchema\n    },\n  \"contact.$.address\" : {\n    optional: true,\n    type: Array\n    },\n  \"contact.$.address.$\" : {\n    optional: true,\n    type: AddressSchema\n    },\n  \"contact.$.gender\" : {\n    optional: true,\n    allowedValues: ['male', 'female', 'other', 'unknown'],\n    type: Code\n    },\n  \"contact.$.organization\" : {\n    optional: true,\n    type: String\n    },\n  \"contact.$.period\" : {\n    optional: true,\n    type: PeriodSchema\n    },\n\n  \"animal\" : {\n    optional: true,\n    type: Object\n    },\n  \"animal.species\" : {\n    type: String\n    //type: CodeableConceptSchema\n    },\n  \"animal.breed\" : {\n    optional: true,\n    type: CodeableConceptSchema\n    },\n  \"animal.genderStatus\" : {\n    optional: true,\n    type: CodeableConceptSchema\n    },\n\n  \"communication\" : {\n    optional: true,\n    type:  Array\n    },\n  \"communication.$\" : {\n    optional: true,\n    type:  Object \n    },    \n  \"communication.$.language\" : {\n    type: CodeableConceptSchema\n    },\n  \"communication.$.preferred\" : {\n    optional: true,\n    type: Boolean\n    },\n  \"generalPractitioner\" : {\n    optional: true,\n    type: Array\n    },\n  \"generalPractitioner.$\" : {\n    optional: true,\n    type: ReferenceSchema\n    },\n  \"managingOrganization\" : {\n    optional: true,\n    type: ReferenceSchema\n    },\n\n  \"link\" : {\n    optional: true,\n    type:  Array\n    },\n  \"link.$\" : {\n    optional: true,\n    type:  Object \n    },   \n  \"link.$.other\" : {\n    type: ReferenceSchema\n    },\n  \"link.$.type\" : {\n    allowedValues: ['replacee', 'refer', 'seealso'],\n    type: Code\n    },\n  \"test\" : {\n    optional: true,\n    type: Boolean\n    }\n});\n\n\n\n\n\nPatientStu3 = new SimpleSchema({\n  \"resourceType\" : {\n    type: String,\n    defaultValue: \"Patient\"\n  },\n  \"identifier\" : {\n    optional: true,\n    type:  Array\n    },\n  \"identifier.$\" : {\n    optional: true,\n    type:  IdentifierSchema \n    },\n  \"active\" : {\n    type: Boolean,\n    optional: true,\n    defaultValue: true\n    },\n  \"name\" : {\n    optional: true,\n    type: Array\n    },\n  \"name.$\" : {\n    optional: true,\n    type: HumanNameSchema \n    },\n  \"telecom\" : {\n    optional: true,\n    type: Array\n    },\n  \"telecom.$\" : {\n    optional: true,\n    type: ContactPointSchema\n    },\n  \"gender\" : {\n    optional: true,\n    allowedValues: ['male', 'female', 'other', 'unknown'],\n    type: String\n    },\n  \"birthDate\" : {\n    optional: true,\n    type: String,\n  },\n  \"_birthDate\" : {\n      optional: true,\n      type: Date,\n      autoValue: function() {\n        var dateArray = [];\n        var date;\n        var value = this.field('birthDate').value;\n        if(typeof value === 'string'){\n          dateArray = value.split('-');\n          date = new Date(dateArray[0], dateArray[1] - 1, dateArray[2])\n        }\n        \n        if(date){\n          return date;\n        }\n      }\n    },\n  \"deceasedBoolean\" : {\n    optional: true,\n    type: Boolean\n    },\n  \"deceasedDateTime\" : {\n    optional: true,\n    type: Date\n    },\n  \"address\" : {\n    optional: true,\n    type: Array\n    },\n  \"address.$\" : {\n    optional: true,\n    type: AddressSchema \n    },\n  \"maritalStatus\" : {\n    optional: true,\n    type: CodeableConceptSchema\n    },\n  \"multipleBirthBoolean\" : {\n    optional: true,\n    type: Boolean\n    },\n  \"multipleBirthInteger\" : {\n    optional: true,\n    type: Number\n    },\n  \"photo\" : {\n    optional: true,\n    type: Array\n    },\n  \"photo.$\" : {\n    optional: true,\n    type: AttachmentSchema \n    },\n\n  \"contact\" : {\n    optional: true,\n    type:  Array\n    },\n  \"contact.$\" : {\n    optional: true,\n    type:  Object \n    },    \n  \"contact.$.relationship\" : {\n    optional: true,\n    type: Array\n    },\n  \"contact.$.relationship.$\" : {\n    optional: true,\n    type: CodeableConceptSchema \n    },\n  \"contact.$.name\" : {\n    optional: true,\n    type: HumanNameSchema\n    },\n  \"contact.$.telecom\" : {\n    optional: true,\n    type: Array\n    },\n  \"contact.$.telecom.$\" : {\n    optional: true,\n    type: ContactPointSchema\n    },\n  \"contact.$.address\" : {\n    optional: true,\n    type: Array\n    },\n  \"contact.$.address.$\" : {\n    optional: true,\n    type: AddressSchema\n    },\n  \"contact.$.gender\" : {\n    optional: true,\n    allowedValues: ['male', 'female', 'other', 'unknown'],\n    type: Code\n    },\n  \"contact.$.organization\" : {\n    optional: true,\n    type: String\n    },\n  \"contact.$.period\" : {\n    optional: true,\n    type: PeriodSchema\n    },\n\n  \"animal\" : {\n    optional: true,\n    type: Object\n    },\n  \"animal.species\" : {\n    type: String\n    //type: CodeableConceptSchema\n    },\n  \"animal.breed\" : {\n    optional: true,\n    type: CodeableConceptSchema\n    },\n  \"animal.genderStatus\" : {\n    optional: true,\n    type: CodeableConceptSchema\n    },\n\n  \"communication\" : {\n    optional: true,\n    type:  Array\n    },\n  \"communication.$\" : {\n    optional: true,\n    type:  Object \n    },    \n  \"communication.$.language\" : {\n    type: CodeableConceptSchema\n    },\n  \"communication.$.preferred\" : {\n    optional: true,\n    type: Boolean\n    },\n  \"generalPractitioner\" : {\n    optional: true,\n    type: Array\n    },\n  \"generalPractitioner.$\" : {\n    optional: true,\n    type: ReferenceSchema\n    },\n  \"managingOrganization\" : {\n    optional: true,\n    type: ReferenceSchema\n    },\n\n  \"link\" : {\n    optional: true,\n    type:  Array\n    },\n  \"link.$\" : {\n    optional: true,\n    type:  Object \n    },   \n  \"link.$.other\" : {\n    type: ReferenceSchema\n    },\n  \"link.$.type\" : {\n    allowedValues: ['replacee', 'refer', 'seealso'],\n    type: Code\n    },\n  \"test\" : {\n    optional: true,\n    type: Boolean\n    }\n});\n\n\n\n\nPatientSchema = PatientDstu2;\n\n// BaseSchema.extend(PatientSchema);\n// DomainResourceSchema.extend(PatientSchema);\n\nPatients.attachSchema(PatientSchema);\n\n\nPatient.prototype.toFhir = function(){\n  console.log('Patient.toFhir()');\n\n\n\n  return EJSON.stringify(this.name);\n}\n\n/**\n * @summary Search the Patients collection for a specific Meteor.userId().\n * @memberOf Patients\n * @name findUserId\n * @version 1.2.3\n * @returns {Boolean}\n * @example\n * ```js\n *  let patients = Patients.findUserId(Meteor.userId());\n *  let patient = patients[0];\n * ```\n */\n\nPatients.findUserId = function (userId) {\n  process.env.TRACE && console.log(\"Patients.findUserId()\");\n  return Patients.find({'identifier.value': userId});\n};\n\n/**\n * @summary Search the Patients collection for a specific Meteor.userId().\n * @memberOf Patients\n * @name findOneUserId\n * @version 1.2.3\n * @returns {Boolean}\n * @example\n * ```js\n *  let patient = Patients.findOneUserId(Meteor.userId());\n * ```\n */\n\nPatients.findOneUserId = function (userId) {\n  process.env.TRACE && console.log(\"Patients.findOneUserId()\");  \n  return Patients.findOne({'identifier.value': userId});\n};\n/**\n * @summary Search the Patients collection for a specific Meteor.userId().\n * @memberOf Patients\n * @name findMrn\n * @version 1.2.3\n * @returns {Boolean}\n * @example\n * ```js\n *  let patients = Patients.findMrn('12345').fetch();\n * ```\n */\n\nPatients.findMrn = function (userId) {\n  process.env.TRACE && console.log(\"Patients.findMrn()\");  \n  return Patients.find({'identifier.value': userId});\n};\nPatients.findByMrn = function (userId) {\n  process.env.TRACE && console.log(\"Patients.findMrn()\");  \n  return Patients.find({'identifier.value': userId});\n};\n\n// Patient/pkdYagnHTR7vk2YZY\nPatients.findByReference = function(input){\n  let inputString = \"\";\n  let patientId = \"\";\n  if(typeof input === \"object\"){\n    inputString = get(input, 'reference')\n  }\n  if(typeof input === \"string\"){\n    inputString = input;\n  }\n  if(inputString.includes(\"/\")){\n    patientId = inputString.split(\"/\")[1];\n  } else {\n    patientId = inputString;\n  }        \n  let patient = Patients.findOne({_id: patientId});\n  return patient;\n}\n\n// we need to look up the patient's phone number\nPatients.findByPhone = function(input){\n  if(validator.isMobilePhone(input)){\n    return Patients.findOne({'telecom.value': input});  \n  } \n}\n\n\n\n\n/**\n * @summary Search the Patients collection for a specific Meteor.userId().\n * @memberOf Patients\n * @name findMrn\n * @version 1.2.3\n * @returns {Boolean}\n * @example\n * ```js\n *  let patients = Patients.findMrn('12345').fetch();\n * ```\n */\n\nPatients.fetchBundle = function (query, parameters, callback) {\n  process.env.TRACE && console.log(\"Patients.fetchBundle()\");  \n  var patientArray = Patients.find(query, parameters, callback).map(function(patient){\n    patient.id = patient._id;\n    delete patient._document;\n    return patient;\n  });\n\n  // console.log(\"patientArray\", patientArray);\n\n  var result = Bundle.generate(patientArray);\n\n  // console.log(\"result\", result.entry[0]);\n\n  return result;\n};\n\n\n/**\n * @summary This function takes a FHIR resource and prepares it for storage in Mongo.\n * @memberOf Patients\n * @name toMongo\n * @version 1.6.0\n * @returns { Patient }\n * @example\n * ```js\n *  let patients = Patients.toMongo('12345').fetch();\n * ```\n */\n\nPatients.toMongo = function (originalPatient) {\n  var mongoRecord;\n  process.env.TRACE && console.log(\"Patients.toMongo()\");  \n\n  if (originalPatient.identifier) {\n    originalPatient.identifier.forEach(function(identifier){\n      if (identifier.period) {\n        if (identifier.period.start) {\n          var startArray = identifier.period.start.split('-');\n          identifier.period.start = new Date(startArray[0], startArray[1] - 1, startArray[2]);\n        }\n        if (identifier.period.end) {\n          var endArray = identifier.period.end.split('-');\n          identifier.period.end = new Date(startArray[0], startArray[1] - 1, startArray[2]);\n        }\n      }\n    });\n  }\n\n  return originalPatient;\n};\n\n\n\n/**\n * @summary This function takes a DTSU2 resource and returns it as STU3.  i.e. it converts from v1.0.2 to v3.0.0\n * @name toMongo\n * @version 3.0.0\n * @returns { Patient }\n * @example\n * ```js\n * ```\n */\nPatients.toStu3 = function(patientJson){\n  if(patientJson){\n\n    // quick cast from string to boolean\n    if(typeof patientJson.birthDate === \"string\"){\n      patientJson.birthDate = new Date(patientJson.birthDate);\n    }\n\n    // quick cast from string to boolean\n    if(patientJson.deceasedBoolean){\n      patientJson.deceasedBoolean = (patientJson.deceasedBoolean == \"true\") ? true : false;\n    }\n\n    // STU3 only has a single entry for family name; not an array\n    if(patientJson.name && patientJson.name[0] && patientJson.name[0].family && patientJson.name[0].family[0] ){\n      patientJson.name[0].family = patientJson.name[0].family[0];      \n    }\n\n    // make sure the full name is filled out\n    if(patientJson.name && patientJson.name[0] && patientJson.name[0].family && !patientJson.name[0].text ){\n      patientJson.name[0].text = patientJson.name[0].given[0] + ' ' + patientJson.name[0].family;      \n    }\n  }\n  return patientJson;\n}\n\n\n/**\n * @summary Similar to toMongo(), this function prepares a FHIR record for storage in the Mongo database.  The difference being, that this assumes there is already an existing record.\n * @memberOf Patients\n * @name prepForUpdate\n * @version 1.6.0\n * @returns { Object }\n * @example\n * ```js\n *  let patients = Patients.findMrn('12345').fetch();\n * ```\n */\n\nPatients.prepForUpdate = function (patient) {\n  process.env.TRACE && console.log(\"Patients.prepForUpdate()\");  \n\n  if (patient.name && patient.name[0]) {\n    //console.log(\"patient.name\", patient.name);\n\n    patient.name.forEach(function(name){\n      name.resourceType = \"HumanName\";\n    });\n  }\n\n  if (patient.telecom && patient.telecom[0]) {\n    //console.log(\"patient.telecom\", patient.telecom);\n    patient.telecom.forEach(function(telecom){\n      telecom.resourceType = \"ContactPoint\";\n    });\n  }\n\n  if (patient.address && patient.address[0]) {\n    //console.log(\"patient.address\", patient.address);\n    patient.address.forEach(function(address){\n      address.resourceType = \"Address\";\n    });\n  }\n\n  if (patient.contact && patient.contact[0]) {\n    //console.log(\"patient.contact\", patient.contact);\n\n    patient.contact.forEach(function(contact){\n      if (contact.name) {\n        contact.name.resourceType = \"HumanName\";\n      }\n\n      if (contact.telecom && contact.telecom[0]) {\n        contact.telecom.forEach(function(telecom){\n          telecom.resourceType = \"ContactPoint\";\n        });\n      }\n\n    });\n  }\n\n  return patient;\n};\n\n\n/**\n * @summary Scrubbing the patient; make sure it conforms to v1.6.0\n * @memberOf Patients\n * @name scrub\n * @version 1.2.3\n * @returns {Boolean}\n * @example\n * ```js\n *  let patients = Patients.findMrn('12345').fetch();\n * ```\n */\n\nPatients.prepForFhirTransfer = function (patient) {\n  process.env.TRACE && console.log(\"Patients.prepForFhirTransfer()\");  \n\n\n  // FHIR has complicated and unusual rules about dates in order\n  // to support situations where a family member might report on a patient's\n  // date of birth, but not know the year of birth; and the other way around\n  if (patient.birthDate) {\n    patient.birthDate = moment(patient.birthDate).format(\"YYYY-MM-DD\");\n  }\n\n\n  if (patient.name && patient.name[0]) {\n    //console.log(\"patient.name\", patient.name);\n\n    patient.name.forEach(function(name){\n      delete name.resourceType;\n    });\n  }\n\n  if (patient.telecom && patient.telecom[0]) {\n    //console.log(\"patient.telecom\", patient.telecom);\n    patient.telecom.forEach(function(telecom){\n      delete telecom.resourceType;\n    });\n  }\n\n  if (patient.address && patient.address[0]) {\n    //console.log(\"patient.address\", patient.address);\n    patient.address.forEach(function(address){\n      delete address.resourceType;\n    });\n  }\n\n  if (patient.contact && patient.contact[0]) {\n    //console.log(\"patient.contact\", patient.contact);\n\n    patient.contact.forEach(function(contact){\n\n      console.log(\"contact\", contact);\n\n\n      if (contact.name && contact.name.resourceType) {\n        //console.log(\"patient.contact.name\", contact.name);\n        delete contact.name.resourceType;\n      }\n\n      if (contact.telecom && contact.telecom[0]) {\n        contact.telecom.forEach(function(telecom){\n          delete telecom.resourceType;\n        });\n      }\n\n    });\n  }\n\n  //console.log(\"Patients.prepForBundle()\", patient);\n\n  return patient;\n};\n\n/**\n * @summary The displayed name of the patient.\n * @memberOf Patient\n * @name displayName\n * @version 1.2.3\n * @returns {Boolean}\n * @example\n * ```js\n * ```\n */\n\nPatient.prototype.display = Patient.prototype.displayName = function () {\n  process.env.TRACE && console.log(\"Patients.displayName()\");  \n\n  if(get(this, 'name[0].family[0]') && get(this, 'name[0].given[0]')){\n    return get(this, 'name[0].given[0]') + ' ' + get(this, 'name[0].family[0]');\n  } else if(get(this, 'name[0].family') && get(this, 'name[0].given[0]')){\n    return get(this, 'name[0].given[0]') + ' ' + get(this, 'name[0].family');\n  } else if(get(this, 'name[0].text')){\n    return get(this, 'name[0].text');\n  } \n};\nPatient.prototype.smartphone = function () {\n  process.env.TRACE && console.log(\"Patients.prototype.smartphone()\");  \n\n  let result = \"\";\n  if(this.telecom){\n    this.telecom.forEach(function(telco){\n      if([\"sms\", \"phone\", \"mobile\", \"smartphone\"].includes(telco.use)){\n        result = telco.value;\n      }\n    });\n  } \n  return result;\n};\n\n\nPatient.prototype.reference = function () {\n  process.env.TRACE && console.log(\"Patients.displayName()\");  \n\n  let result = {\n    display: this.display(),\n    reference: 'Patient/' + this.id\n  }\n  return result;\n};\n\n\n\n\n\n\n\n\n/**\n * @summary The displayed Meteor.userId() of the patient.\n * @memberOf Patient\n * @name userId\n * @version 1.2.3\n * @returns {Boolean}\n * @example\n * ```js\n * ```\n */\n\nPatient.prototype.userId = function () {\n  process.env.TRACE && console.log(\"Patients.userId()\");  \n\n  var result = null;\n  if (this.extension) {\n    this.extension.forEach(function(extension){\n      if (extension.url === \"Meteor.userId()\") {\n        result = extension.valueString;\n      }\n    });\n  }\n  return result;\n};\n\n\n\n/**\n * @summary The displayed Meteor.userId() of the patient.\n * @memberOf Patient\n * @name userId\n * @version 1.2.3\n * @returns {Boolean}\n * @example\n * ```js\n * ```\n */\n\n\n/**\n * @summary Anonymize the patient record\n * @memberOf Patient\n * @name removeProtectedInfo\n * @version 1.2.3\n * @returns {Object}\n * @example\n * ```js\n * ```\n */\n\nPatient.prototype.removeProtectedInfo = function (options) {\n  process.env.TRACE && console.log(\"Patients.anonymize()\", this);  \n\n  console.log(\"Patients.anonymize()\");  \n\n  // 1. Names\n  if(this.name && this.name[0]){\n    var anonymizedName = this.name[0];\n\n    if(this.name[0].family){\n      anonymizedName.family = '';\n    }\n    if(this.name[0].given && this.name[0].given[0]){\n      anonymizedName.given = [];          \n    }\n    if(this.name[0].text){\n      anonymizedName.text = '';\n    }\n\n    this.name = [];\n    this.name.push(anonymizedName);\n  }\n\n  // 3.  dates\n\n\n  // 4. Phone numbers\n  // 5.  Fax Numbers\n  // 6.  Identifiers\n  // 7.  Medical Record Nubers\n  // 17.  Photos\n\n  return this;\n}\n\n\n/**\n * @summary Anonymize the patient record\n * @memberOf Patient\n * @name anonymize\n * @version 1.2.3\n * @returns {Object}\n * @example\n * ```js\n * ```\n */\n\nPatient.prototype.anonymize = function () {\n  process.env.TRACE && console.log(\"Patients.hash()\", this);  \n\n  console.log(\"Patients.hash()\");  \n\n\n  if(this.name && this.name[0]){\n    var anonymizedName = this.name[0];\n\n    if(this.name[0].family){\n      anonymizedName.family = Anon.name(this.name[0].family);        \n    }\n    if(this.name[0].given && this.name[0].given[0]){\n      var secretGiven = Anon.name(this.name[0].given[0]);\n      anonymizedName.given = [];      \n      anonymizedName.given.push(secretGiven);\n    }\n    if(this.name[0].text){\n      anonymizedName.text = Anon.name(this.name[0].text);\n    }\n\n    this.name = [];\n    this.name.push(anonymizedName);\n  }\n\n  return this;\n}\n\n\nAnon = {\n  name: function(name){\n    var anonName = '';\n    for(var i = 0; i < name.length; i++){\n      if(name[i] === \" \"){\n        anonName = anonName + \" \";\n      } else {\n        anonName = anonName + \"*\";\n      }\n    }\n    return anonName;\n  },\n  phone: function(){\n    return \"NNN-NNN-NNNN\";\n  },\n  ssn: function(){\n    return \"###-##-####\"\n  }\n}\n\n\nexport { Patient, Patients, PatientSchema, PatientStu3, PatientDstu2 };\n","\n\n// import PatientDetail from './client/react/PatientDetail.js';\n// import PatientPickList from './client/react/PatientPickList.js';\n// import PatientsPage from './client/react/PatientsPage.js';\n// import PatientTable from './client/react/PatientTable.js';\n// import { insertPatient, removePatientById, updatePatient } from './lib/methods.js';\n\n// import {PatientTable as PatientsTable} from './client/react/PatientTable';\n// import PatientDetail from './client/react/PatientDetail';\n// import PatientCard from './client/react/PatientCard';\n// import PatientTable from './client/react/PatientTable';\n\nimport PatientsPage from './client/react/PatientsPage';\nimport { PatientCard, PatientDetail, PatientTable } from 'material-fhir-ui';\nimport { Patient, Patients, PatientSchema, PatientDstu2, PatientStu3 } from './lib/Patients';\n\nconst PatientTables = PatientTable;\n\nvar DynamicRoutes = [{\n  'name': 'PatientPage',\n  'path': '/patients',\n  'component': PatientsPage,\n  'requireAuth': true\n}];\n\nvar SidebarElements = [{\n  'primaryText': 'Patients',\n  'to': '/patients',\n  'href': '/patients'\n}];\n\nexport { \n  SidebarElements, \n  DynamicRoutes, \n\n  PatientsPage,\n  PatientTable,\n  PatientsTable,\n  PatientDetail,\n  PatientCard,\n\n  Patient,\n  Patients,\n  PatientSchema,\n  PatientDstu2, \n  PatientStu3\n};\n\n\n","import { CardText, CardTitle, RaisedButton, Tab, Tabs } from 'material-ui';\nimport { Glass, GlassCard, VerticalCanvas, FullPageCanvas } from 'meteor/clinical:glass-ui';\n\nimport { PatientTable, PatientDetail } from 'material-fhir-ui';\n\nimport React from 'react';\nimport { ReactMeteorData } from 'meteor/react-meteor-data';\nimport ReactMixin from 'react-mixin';\nimport PropTypes from 'prop-types';\n\nimport { Meteor } from 'meteor/meteor';\nimport { Session } from 'meteor/session';\nimport { HTTP } from 'meteor/http';\n\nimport { get } from 'lodash';\n\nlet defaultPatient = {\n  index: 2,\n  id: '',\n  username: '',\n  email: '',\n  given: '',\n  family: '',\n  gender: ''\n};\nSession.setDefault('patientFormData', defaultPatient);\nSession.setDefault('patientSearchFilter', '');\nSession.setDefault('selectedPatientId', false);\nSession.setDefault('fhirVersion', 'v1.0.2');\n\nexport class PatientsPage extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      patientId: false,\n      patient: {}\n    }\n  }\n\n  getMeteorData() {\n    let data = {\n      style: {\n        opacity: Session.get('globalOpacity'),\n        tab: {\n          borderBottom: '1px solid lightgray',\n          borderRight: 'none'\n        }\n      },\n      tabIndex: Session.get('patientPageTabIndex'),\n      patientSearchFilter: Session.get('patientSearchFilter'),\n      fhirVersion: Session.get('fhirVersion'),\n      selectedPatientId: Session.get(\"selectedPatientId\"),\n      paginationLimit: 100,\n      selectedPatient: false,\n      selected: [],\n      patients: []\n    };\n\n    // number of items in the table should be set globally\n    if (get(Meteor, 'settings.public.defaults.paginationLimit')) {\n      data.paginationLimit = get(Meteor, 'settings.public.defaults.paginationLimit');\n    }\n\n    if (Session.get('selectedPatientId')){\n      data.selectedPatient = Patients.findOne({_id: Session.get('selectedPatientId')});\n      this.state.patient = Patients.findOne({_id: Session.get('selectedPatientId')});\n      this.state.patientId = Session.get('selectedPatientId');\n    } else {\n      data.selectedPatient = false;\n      this.state.patientId = false;\n      this.state.patient = {}\n    }\n\n    data.patients = Patients.find().fetch();\n\n    data.style = Glass.blur(data.style);\n    data.style.appbar = Glass.darkroom(data.style.appbar);\n    data.style.tab = Glass.darkroom(data.style.tab);\n\n    if(process.env.NODE_ENV === \"test\") console.log(\"PatientsPage[data]\", data);\n    return data;\n  }\n  onCancelUpsertPatient(context){\n    Session.set('patientPageTabIndex', 1);\n  }\n  onDeletePatient(context){\n    Patients._collection.remove({_id: context.state.patientId}, function(error, result){\n      if (error) {\n        if(process.env.NODE_ENV === \"test\") console.log('Patients.insert[error]', error);\n        Bert.alert(error.reason, 'danger');\n      }\n      if (result) {\n        HipaaLogger.logEvent({eventType: \"delete\", userId: Meteor.userId(), userName: Meteor.user().fullName(), collectionName: \"Patients\", recordId: context.state.patientId});\n        Session.set('patientPageTabIndex', 1);\n        Session.set('selectedPatientId', false);\n        Bert.alert('Patient removed!', 'success');\n      }\n    });\n  }\n  onUpsertPatient(context){\n    //if(process.env.NODE_ENV === \"test\") console.log('^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^&&')\n    console.log('Saving a new Patient...', context.state)\n\n    if(get(context, 'state.patient')){\n      let self = context;\n      let fhirPatientData = Object.assign({}, context.state.patient);\n  \n      if(process.env.NODE_ENV === \"test\") console.log('fhirPatientData', fhirPatientData);\n  \n  \n      let patientValidator = PatientSchema.newContext();\n      // console.log('patientValidator', patientValidator)\n      patientValidator.validate(fhirPatientData)\n  \n      if(process.env.NODE_ENV === \"development\"){\n        console.log('IsValid: ', patientValidator.isValid())\n        console.log('ValidationErrors: ', patientValidator.validationErrors());\n  \n      }\n  \n      console.log('Checking context.state again...', context.state)\n      if (get(context, 'state.patientId')) {\n        if(process.env.NODE_ENV === \"development\") {\n          console.log(\"Updating patient...\");\n        }\n\n        delete fhirPatientData._id;\n  \n        // not sure why we're having to respecify this; fix for a bug elsewhere\n        fhirPatientData.resourceType = 'Patient';\n  \n        Patients._collection.update({_id: context.state.patientId}, {$set: fhirPatientData }, function(error, result){\n          if (error) {\n            if(process.env.NODE_ENV === \"test\") console.log(\"Patients.insert[error]\", error);\n            Bert.alert(error.reason, 'danger');\n          }\n          if (result) {\n            HipaaLogger.logEvent({eventType: \"update\", userId: Meteor.userId(), userName: Meteor.user().fullName(), collectionName: \"Patients\", recordId: context.state.patientId});\n            Session.set('selectedPatientId', false);\n            Session.set('patientPageTabIndex', 1);\n            Bert.alert('Patient added!', 'success');\n          }\n        });\n      } else {\n        if(process.env.NODE_ENV === \"test\") console.log(\"Creating a new patient...\", fhirPatientData);\n  \n        Patients._collection.insert(fhirPatientData, function(error, result) {\n          if (error) {\n            if(process.env.NODE_ENV === \"test\")  console.log('Patients.insert[error]', error);\n            Bert.alert(error.reason, 'danger');\n          }\n          if (result) {\n            HipaaLogger.logEvent({eventType: \"create\", userId: Meteor.userId(), userName: Meteor.user().fullName(), collectionName: \"Patients\", recordId: context.state.patientId});\n            Session.set('patientPageTabIndex', 1);\n            Session.set('selectedPatientId', false);\n            Bert.alert('Patient added!', 'success');\n          }\n        });\n      }\n    } \n  }\n  onTableRowClick(patientId){\n    Session.set('selectedPatientId', patientId);\n    Session.set('selectedPatient', Patients.findOne(patientId));\n\n  }\n  onTableCellClick(id){\n    Session.set('patientsUpsert', false);\n    Session.set('selectedPatientId', id);\n    Session.set('patientPageTabIndex', 2);\n  }\n  tableActionButtonClick(id){\n    let patient = Patients.findOne({_id: id});\n\n    // console.log(\"PatientTable.onSend()\", patient);\n\n    var httpEndpoint = \"http://localhost:8080\";\n    if (get(Meteor, 'settings.public.interfaces.default.channel.endpoint')) {\n      httpEndpoint = get(Meteor, 'settings.public.interfaces.default.channel.endpoint');\n    }\n    HTTP.post(httpEndpoint + '/Patient', {\n      data: patient\n    }, function(error, result){\n      if (error) {\n        console.log(\"error\", error);\n      }\n      if (result) {\n        console.log(\"result\", result);\n      }\n    });\n  }\n  handleTabChange(index){\n    Session.set('patientPageTabIndex', index);\n  }\n\n  onNewTab(){\n    Session.set('selectedPatientId', false);\n    Session.set('patientUpsert', false);\n  }\n\n  render() {\n    console.log('React.version: ' + React.version);\n\n    return (\n      <div id=\"patientsPage\">\n        <VerticalCanvas>\n          <GlassCard height=\"auto\">\n            <CardTitle\n              title=\"Patients\"\n            />\n            <CardText>\n              <Tabs id='patientsPageTabs' default value={this.data.tabIndex} onChange={this.handleTabChange} initialSelectedIndex={1}>\n                 <Tab className=\"newPatientTab\" label='New' style={this.data.style.tab} onActive={ this.onNewTab } value={0}>\n                   <PatientDetail \n                      fhirVersion={ this.data.fhirVersion }\n                      id='newPatient' \n                      onDelete={ this.onDeletePatient }\n                      onUpsert={ this.onUpsertPatient }\n                      onCancel={ this.onCancelUpsertPatient } \n                      />\n                 </Tab>\n                 <Tab className=\"patientListTab\" label='Patients' onActive={this.handleActive} style={this.data.style.tab} value={1}>\n                   <PatientTable \n                      noDataMessagePadding={100}\n                      patients={ this.data.patients }\n                      paginationLimit={ this.data.pagnationLimit }\n                      appWidth={ Session.get('appWidth') }\n                      actionButtonLabel=\"Send\"\n                      onRowClick={ this.onTableRowClick }\n                      onCellClick={ this.onTableCellClick }\n                      onActionButtonClick={this.tableActionButtonClick}\n                      />\n                 </Tab>\n                 <Tab className=\"patientDetailTab\" label='Detail' onActive={this.handleActive} style={this.data.style.tab} value={2}>\n                   <PatientDetail \n                      id='patientDetails' \n                      fhirVersion={ this.data.fhirVersion }\n                      patient={ this.data.selectedPatient }\n                      patientId={ this.data.selectedPatientId }\n                      onDelete={ this.onDeletePatient }\n                      onUpsert={ this.onUpsertPatient }\n                      onCancel={ this.onCancelUpsertPatient } \n                    />\n                 </Tab>\n             </Tabs>\n\n\n            </CardText>\n          </GlassCard>\n        </VerticalCanvas>\n      </div>\n    );\n  }\n}\n\n\n\nReactMixin(PatientsPage.prototype, ReactMeteorData);\n\nexport default PatientsPage;"]}