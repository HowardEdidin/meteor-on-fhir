{"version":3,"sources":["meteor://ðŸ’»app/packages/clinical:hl7-resource-subscription/lib/Subscriptions.js","meteor://ðŸ’»app/packages/clinical:hl7-resource-subscription/index.jsx","meteor://ðŸ’»app/packages/clinical:hl7-resource-subscription/client/SubscriptionDetail.jsx","meteor://ðŸ’»app/packages/clinical:hl7-resource-subscription/client/SubscriptionTable.jsx","meteor://ðŸ’»app/packages/clinical:hl7-resource-subscription/client/SubscriptionsPage.jsx"],"names":["module","export","Subscription","Subscriptions","SubscriptionSchema","SimpleSchema","link","v","BaseModel","Mongo","BaseSchema","DomainResourceSchema","extend","prototype","_collection","Package","Collection","connection","_transform","document","type","String","defaultValue","optional","Array","IdentifierSchema","Code","ContactPointSchema","Date","Object","allowedValues","blackbox","attachSchema","toFhir","console","log","EJSON","stringify","name","fetchBundle","query","parameters","callback","process","env","TRACE","subscriptionArray","find","map","subscription","id","_id","_document","result","Bundle","generate","toMongo","originalSubscription","mongoRecord","identifier","forEach","period","start","startArray","split","end","endArray","toStu3","subscriptionJson","birthDate","deceasedBoolean","family","text","given","prepForUpdate","resourceType","telecom","address","contact","prepForFhirTransfer","AdminSidebarElements","SidebarElements","DynamicRoutes","SubscriptionsPage","SubscriptionTable","SubscriptionDetail","CardActions","CardText","get","has","set","insertSubscription","removeSubscriptionById","updateSubscription","Bert","RaisedButton","React","ReactMeteorData","ReactMixin","TextField","Session","defaultSubscription","url","setDefault","getMeteorData","data","subscriptionId","selectedSubscription","findOne","moment","add","format","NODE_ENV","render","props","determineButtons","handleSaveButton","bind","marginRight","handleDeleteButton","changeState","field","event","value","subscriptionUpdate","gender","toLowerCase","photo","update","$set","error","alert","reason","HipaaLogger","logEvent","eventType","userId","Meteor","userName","user","fullName","collectionName","recordId","insert","handleCancelButton","remove","Component","Avatar","FlatButton","HTTP","Table","TableNoData","style","hideOnPhone","visibility","display","cellHideOnPhone","paddingTop","cell","selected","subscriptions","patient","options","limit","status","criteria","endpoint","payload","JSON","rowClick","tableRows","footer","length","noDataMessage","i","push","cursor","exportDefault","CardTitle","Tab","Tabs","GlassCard","Glass","VerticalCanvas","FullPageCanvas","index","username","email","opacity","tab","borderBottom","borderRight","tabIndex","subscriptionSearchFilter","currentSubscription","blur","appbar","darkroom","handleTabChange","onNewTab","version"],"mappings":"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","file":"/packages/clinical_hl7-resource-subscription.js","sourcesContent":["// https://www.hl7.org/fhir/subscription.html\n\nimport SimpleSchema from 'simpl-schema';\n\nimport { BaseModel } from 'meteor/clinical:base-model';\nimport { Mongo } from 'meteor/mongo';\nimport { BaseSchema, DomainResourceSchema } from 'meteor/clinical:hl7-resource-datatypes';\n\n\n// create the object using our BaseModel\nSubscription = BaseModel.extend();\n\n\n//Assign a collection so the object knows how to perform CRUD operations\nSubscription.prototype._collection = Subscriptions;\n\n\n// Create a persistent data store for addresses to be stored.\n// HL7.Resources.Subscriptions = new Mongo.Collection('HL7.Resources.Subscriptions');\n\nif(typeof Subscriptions === 'undefined'){\n  if(Package['clinical:autopublish']){\n    Subscriptions = new Mongo.Collection('Subscriptions');\n  } else if(Package['clinical:desktop-publish']){ \n    Subscriptions = new Mongo.Collection('Subscriptions');\n  } else {\n    Subscriptions = new Mongo.Collection('Subscriptions', {connection: null});\n  }\n}\n\n\n//Add the transform to the collection since Meteor.users is pre-defined by the accounts package\nSubscriptions._transform = function (document) {\n  return new Subscription(document);\n};\n\n\n\nSubscriptionSchema = new SimpleSchema({\n  \"resourceType\" : {\n    type: String,\n    defaultValue: \"Subscription\"\n  },\n  \"identifier\" : {\n    optional: true,\n    type:  Array\n    },\n  \"identifier.$\" : {\n    optional: true,\n    type:  IdentifierSchema \n    },\n  \"status\" : {\n    optional: true,\n    type: Code\n  }, \n  \"contact\" : {\n    optional: true,\n    type: Array\n  }, \n  \"contact.$\" : {\n    optional: true,\n    type: ContactPointSchema \n  }, \n  \"end\" : {\n    optional: true,\n    type: Date\n  },\n  \"reason\" : {\n    optional: true,\n    type: String\n  },\n  \"criteria\": {\n    optional: true,\n    type: String\n  },\n  \"channel\" : {\n    optional: true,\n    type:  Object \n    },\n  \"channel.type\": {\n    optional: false,\n    type: String,\n    allowedValues: [\"rest-hook\", \"websocket\", \"email\", \"sms\", \"message\"],\n    defaultValue: \"websocket\"\n  },\n  \"channel.endpoint\": {\n    optional: true,\n    type: String\n  },\n  \"channel.payload\": {\n    optional: true,\n    type: String\n  },\n  \"channel.header\": {\n    optional: true,\n    type: Array\n  },\n  \"channel.header.$\": {\n    optional: true,\n    type: String \n  },\n  \"channel.resourceType\": {\n    optional: true,\n    type: String \n  },\n  \"channel.query\": {\n    optional: true,\n    blackbox: true,\n    type: Object \n  },\n  \"channel.options\": {\n    optional: true,\n    blackbox: true,\n    type: String\n  },\n  \"channel.triggers\": {\n    optional: true,\n    blackbox: true,\n    type: Object \n  },\n  \"tag\": {\n    optional: true,\n    type: Array\n  },\n  \"tag.$\": {\n    optional: true,\n    type: String \n  }\n});\n\nBaseSchema.extend(SubscriptionSchema);\nDomainResourceSchema.extend(SubscriptionSchema);\n\nSubscriptions.attachSchema(SubscriptionSchema);\n\n\nSubscription.prototype.toFhir = function(){\n  console.log('Subscription.toFhir()');\n  return EJSON.stringify(this.name);\n}\n\n\n\n/**\n * @summary Search the Subscriptions collection for a specific Meteor.userId().\n * @memberOf Subscriptions\n * @name findMrn\n * @version 1.2.3\n * @returns {Boolean}\n * @example\n * ```js\n *  let subscriptions = Subscriptions.findMrn('12345').fetch();\n * ```\n */\n\nSubscriptions.fetchBundle = function (query, parameters, callback) {\n  process.env.TRACE && console.log(\"Subscriptions.fetchBundle()\");  \n  var subscriptionArray = Subscriptions.find(query, parameters, callback).map(function(subscription){\n    subscription.id = subscription._id;\n    delete subscription._document;\n    return subscription;\n  });\n\n  // console.log(\"subscriptionArray\", subscriptionArray);\n\n  var result = Bundle.generate(subscriptionArray);\n\n  // console.log(\"result\", result.entry[0]);\n\n  return result;\n};\n\n\n/**\n * @summary This function takes a FHIR resource and prepares it for storage in Mongo.\n * @memberOf Subscriptions\n * @name toMongo\n * @version 1.6.0\n * @returns { Subscription }\n * @example\n * ```js\n *  let subscriptions = Subscriptions.toMongo('12345').fetch();\n * ```\n */\n\nSubscriptions.toMongo = function (originalSubscription) {\n  var mongoRecord;\n  process.env.TRACE && console.log(\"Subscriptions.toMongo()\");  \n\n  if (originalSubscription.identifier) {\n    originalSubscription.identifier.forEach(function(identifier){\n      if (identifier.period) {\n        if (identifier.period.start) {\n          var startArray = identifier.period.start.split('-');\n          identifier.period.start = new Date(startArray[0], startArray[1] - 1, startArray[2]);\n        }\n        if (identifier.period.end) {\n          var endArray = identifier.period.end.split('-');\n          identifier.period.end = new Date(startArray[0], startArray[1] - 1, startArray[2]);\n        }\n      }\n    });\n  }\n\n  return originalSubscription;\n};\n\n\n\n/**\n * @summary This function takes a DTSU2 resource and returns it as STU3.  i.e. it converts from v1.0.2 to v3.0.0\n * @name toMongo\n * @version 3.0.0\n * @returns { Subscription }\n * @example\n * ```js\n * ```\n */\nSubscriptions.toStu3 = function(subscriptionJson){\n  if(subscriptionJson){\n\n    // quick cast from string to boolean\n    if(typeof subscriptionJson.birthDate === \"string\"){\n      subscriptionJson.birthDate = new Date(subscriptionJson.birthDate);\n    }\n\n    // quick cast from string to boolean\n    if(subscriptionJson.deceasedBoolean){\n      subscriptionJson.deceasedBoolean = (subscriptionJson.deceasedBoolean == \"true\") ? true : false;\n    }\n\n    // STU3 only has a single entry for family name; not an array\n    if(subscriptionJson.name && subscriptionJson.name[0] && subscriptionJson.name[0].family && subscriptionJson.name[0].family[0] ){\n      subscriptionJson.name[0].family = subscriptionJson.name[0].family[0];      \n    }\n\n    // make sure the full name is filled out\n    if(subscriptionJson.name && subscriptionJson.name[0] && subscriptionJson.name[0].family && !subscriptionJson.name[0].text ){\n      subscriptionJson.name[0].text = subscriptionJson.name[0].given[0] + ' ' + subscriptionJson.name[0].family;      \n    }\n  }\n  return subscriptionJson;\n}\n\n\n/**\n * @summary Similar to toMongo(), this function prepares a FHIR record for storage in the Mongo database.  The difference being, that this assumes there is already an existing record.\n * @memberOf Subscriptions\n * @name prepForUpdate\n * @version 1.6.0\n * @returns { Object }\n * @example\n * ```js\n *  let subscriptions = Subscriptions.findMrn('12345').fetch();\n * ```\n */\n\nSubscriptions.prepForUpdate = function (subscription) {\n  process.env.TRACE && console.log(\"Subscriptions.prepForUpdate()\");  \n\n  if (subscription.name && subscription.name[0]) {\n    //console.log(\"subscription.name\", subscription.name);\n\n    subscription.name.forEach(function(name){\n      name.resourceType = \"HumanName\";\n    });\n  }\n\n  if (subscription.telecom && subscription.telecom[0]) {\n    //console.log(\"subscription.telecom\", subscription.telecom);\n    subscription.telecom.forEach(function(telecom){\n      telecom.resourceType = \"ContactPoint\";\n    });\n  }\n\n  if (subscription.address && subscription.address[0]) {\n    //console.log(\"subscription.address\", subscription.address);\n    subscription.address.forEach(function(address){\n      address.resourceType = \"Address\";\n    });\n  }\n\n  if (subscription.contact && subscription.contact[0]) {\n    //console.log(\"subscription.contact\", subscription.contact);\n\n    subscription.contact.forEach(function(contact){\n      if (contact.name) {\n        contact.name.resourceType = \"HumanName\";\n      }\n\n      if (contact.telecom && contact.telecom[0]) {\n        contact.telecom.forEach(function(telecom){\n          telecom.resourceType = \"ContactPoint\";\n        });\n      }\n\n    });\n  }\n\n  return subscription;\n};\n\n\n/**\n * @summary Scrubbing the subscription; make sure it conforms to v1.6.0\n * @memberOf Subscriptions\n * @name scrub\n * @version 1.2.3\n * @returns {Boolean}\n * @example\n * ```js\n *  let subscriptions = Subscriptions.findMrn('12345').fetch();\n * ```\n */\n\nSubscriptions.prepForFhirTransfer = function (subscription) {\n  process.env.TRACE && console.log(\"Subscriptions.prepForFhirTransfer()\");  \n\n  return subscription;\n};\n\n\n\nexport { Subscription, Subscriptions, SubscriptionSchema };\n","\nimport SubscriptionsPage from './client/SubscriptionsPage';\nimport SubscriptionTable from './client/SubscriptionTable';\nimport { Subscription, Subscriptions, SubscriptionSchema } from './lib/Subscriptions';\n\nvar DynamicRoutes = [{\n  'name': 'SubscriptionPage',\n  'path': '/subscriptions',\n  'component': SubscriptionsPage,\n  'requireAuth': true\n}];\n\nvar SidebarElements = [{\n  'primaryText': 'Subscriptions',\n  'to': '/subscriptions',\n  'href': '/subscriptions'\n}];\nvar AdminSidebarElements = [{\n  'primaryText': 'Subscriptions',\n  'to': '/subscriptions',\n  'href': '/subscriptions'\n}];\n\nexport { \n  AdminSidebarElements,\n  SidebarElements, \n  DynamicRoutes, \n\n  SubscriptionsPage,\n  SubscriptionTable\n};\n\n\n","import { CardActions, CardText } from 'material-ui/Card';\nimport { get, has, set } from 'lodash';\nimport { insertSubscription, removeSubscriptionById, updateSubscription } from 'meteor/clinical:hl7-resource-subscription';\n\n\nimport { Bert } from 'meteor/clinical:alert';\nimport RaisedButton from 'material-ui/RaisedButton';\nimport React from 'react';\nimport { ReactMeteorData } from 'meteor/react-meteor-data';\nimport ReactMixin from 'react-mixin';\nimport TextField from 'material-ui/TextField';\n\nimport { Subscriptions } from '../lib/Subscriptions';\nimport { Session } from 'meteor/session';\n\n\nlet defaultSubscription = {\n  \"resourceType\" : \"Subscription\",\n  \"name\" : [{\n    \"text\" : \"\",\n    \"resourceType\" : \"HumanName\"\n  }],\n  \"active\" : true,\n  \"gender\" : \"\",\n  \"birthDate\" : '',\n  \"photo\" : [{\n    url: \"\"\n  }],\n  identifier: [{\n    \"use\": \"usual\",\n    \"type\": {\n      \"coding\": [\n        {\n          \"system\": \"http://hl7.org/fhir/v2/0203\",\n          \"code\": \"MR\"\n        }\n      ]\n    },\n    \"value\": \"\"\n  }],\n  \"test\" : false\n};\n\n\nSession.setDefault('subscriptionUpsert', false);\nSession.setDefault('selectedSubscription', false);\n\nexport default class SubscriptionDetail extends React.Component {\n  getMeteorData() {\n    let data = {\n      subscriptionId: false,\n      subscription: defaultSubscription\n    };\n\n    if (Session.get('subscriptionUpsert')) {\n      data.subscription = Session.get('subscriptionUpsert');\n    } else {\n      if (Session.get('selectedSubscription')) {\n        data.subscriptionId = Session.get('selectedSubscription');\n        console.log(\"selectedSubscription\", Session.get('selectedSubscription'));\n\n        let selectedSubscription = Subscriptions.findOne({_id: Session.get('selectedSubscription')});\n        console.log(\"selectedSubscription\", selectedSubscription);\n\n        if (selectedSubscription) {\n          data.subscription = selectedSubscription;\n\n          if (typeof selectedSubscription.birthDate === \"object\") {\n            data.subscription.birthDate = moment(selectedSubscription.birthDate).add(1, 'day').format(\"YYYY-MM-DD\");\n          }\n        }\n      } else {\n        data.subscription = defaultSubscription;\n      }\n    }\n\n    if(process.env.NODE_ENV === \"test\") console.log(\"SubscriptionDetail[data]\", data);\n    return data;\n  }\n\n  render() {\n    return (\n      <div id={this.props.id} className=\"subscriptionDetail\">\n        <CardText>\n          {/* <TextField\n            id='nameInput'\n            ref='name'\n            name='name'\n            floatingLabelText='name'\n            value={ get(this, 'data.subscription.name[0].text', '')}\n            onChange={ this.changeState.bind(this, 'name')}\n            fullWidth\n            /><br/>\n          <TextField\n            id='genderInput'\n            ref='gender'\n            name='gender'\n            floatingLabelText='gender'\n            hintText='male | female | other | indeterminate | unknown'\n            value={ get(this, 'data.subscription.gender', '')}\n            onChange={ this.changeState.bind(this, 'gender')}\n            fullWidth\n            /><br/>\n          <TextField\n            id='birthdateInput'\n            ref='birthdate'\n            name='birthdate'\n            floatingLabelText='birthdate'\n            hintText='YYYY-MM-DD'\n            value={ get(this, 'data.subscription.birthDate', '')}\n            onChange={ this.changeState.bind(this, 'birthDate')}\n            fullWidth\n            /><br/>\n          <TextField\n            id='photoInput'\n            ref='photo'\n            name='photo'\n            floatingLabelText='photo'\n            value={ get(this, 'data.subscription.photo[0].url', '')}\n            onChange={ this.changeState.bind(this, 'photo')}\n            floatingLabelFixed={false}\n            fullWidth\n            /><br/>\n          <TextField\n            id='mrnInput'\n            ref='mrn'\n            name='mrn'\n            floatingLabelText='medical record number'\n            value={ get(this, 'data.subscription.identifier[0].value', '')}\n            onChange={ this.changeState.bind(this, 'mrn')}\n            fullWidth\n            /><br/> */}\n        </CardText>\n        <CardActions>\n          { this.determineButtons(this.data.subscriptionId) }\n        </CardActions>\n      </div>\n    );\n  }\n  determineButtons(subscriptionId){\n    if (subscriptionId) {\n      return (\n        <div>\n          <RaisedButton id='saveSubscriptionButton' className='saveSubscriptionButton' label=\"Save\" primary={true} onClick={this.handleSaveButton.bind(this)} style={{marginRight: '20px'}} />\n          <RaisedButton label=\"Delete\" onClick={this.handleDeleteButton.bind(this)} />\n        </div>\n      );\n    } else {\n      return(\n        <RaisedButton id='saveSubscriptionButton'  className='saveSubscriptionButton' label=\"Save\" primary={true} onClick={this.handleSaveButton.bind(this)} />\n      );\n    }\n  }\n\n  changeState(field, event, value){\n    let subscriptionUpdate;\n\n    if(process.env.TRACE) console.log(\"subscriptionDetail.changeState\", field, event, value);\n\n    // by default, assume there's no other data and we're creating a new subscription\n    if (Session.get('subscriptionUpsert')) {\n      subscriptionUpdate = Session.get('subscriptionUpsert');\n    } else {\n      subscriptionUpdate = defaultSubscription;\n    }\n\n\n\n    // if there's an existing subscription, use them\n    if (Session.get('selectedSubscription')) {\n      subscriptionUpdate = this.data.subscription;\n    }\n\n    switch (field) {\n      case \"name\":\n        subscriptionUpdate.name[0].text = value;\n        break;\n      case \"gender\":\n        subscriptionUpdate.gender = value.toLowerCase();\n        break;\n      case \"birthDate\":\n        subscriptionUpdate.birthDate = value;\n        break;\n      case \"photo\":\n        subscriptionUpdate.photo[0].url = value;\n        break;\n      case \"mrn\":\n        subscriptionUpdate.identifier[0].value = value;\n        break;\n      default:\n\n    }\n    // subscriptionUpdate[field] = value;\n    process.env.TRACE && console.log(\"subscriptionUpdate\", subscriptionUpdate);\n\n    Session.set('subscriptionUpsert', subscriptionUpdate);\n  }\n\n\n  // this could be a mixin\n  handleSaveButton(){\n    if(process.env.NODE_ENV === \"test\") console.log('handleSaveButton()');\n    let subscriptionUpdate = Session.get('subscriptionUpsert', subscriptionUpdate);\n\n\n    if (subscriptionUpdate.birthDate) {\n      subscriptionUpdate.birthDate = new Date(subscriptionUpdate.birthDate);\n    }\n    if(process.env.NODE_ENV === \"test\") console.log(\"subscriptionUpdate\", subscriptionUpdate);\n\n    if (Session.get('selectedSubscription')) {\n      if(process.env.NODE_ENV === \"test\") console.log(\"Updating subscription...\");\n\n      delete subscriptionUpdate._id;\n\n      // not sure why we're having to respecify this; fix for a bug elsewhere\n      subscriptionUpdate.resourceType = 'Subscription';\n\n      Subscriptions.update({_id: Session.get('selectedSubscription')}, {$set: subscriptionUpdate }, function(error, result){\n        if (error) {\n          if(process.env.NODE_ENV === \"test\") console.log(\"Subscriptions.insert[error]\", error);\n          Bert.alert(error.reason, 'danger');\n        }\n        if (result) {\n          HipaaLogger.logEvent({eventType: \"update\", userId: Meteor.userId(), userName: Meteor.user().fullName(), collectionName: \"Subscriptions\", recordId: Session.get('selectedSubscription')});\n          // Session.set('subscriptionUpdate', defaultSubscription);\n          Session.set('subscriptionUpsert', false);\n          Session.set('selectedSubscription', false);\n          Session.set('subscriptionPageTabIndex', 1);\n          Bert.alert('Subscription added!', 'success');\n        }\n      });\n    } else {\n      if(process.env.NODE_ENV === \"test\") console.log(\"Creating a new subscription...\", subscriptionUpdate);\n\n      Subscriptions.insert(subscriptionUpdate, function(error, result) {\n        if (error) {\n          if(process.env.NODE_ENV === \"test\")  console.log('Subscriptions.insert[error]', error);\n          Bert.alert(error.reason, 'danger');\n        }\n        if (result) {\n          HipaaLogger.logEvent({eventType: \"create\", userId: Meteor.userId(), userName: Meteor.user().fullName(), collectionName: \"Subscriptions\", recordId: result});\n          Session.set('subscriptionPageTabIndex', 1);\n          Session.set('selectedSubscription', false);\n          Session.set('subscriptionUpsert', false);\n          Bert.alert('Subscription added!', 'success');\n        }\n      });\n    }\n  }\n\n  handleCancelButton(){\n    Session.set('subscriptionPageTabIndex', 1);\n  }\n\n  handleDeleteButton(){\n    Subscriptions.remove({_id: Session.get('selectedSubscription')}, function(error, result){\n      if (error) {\n        if(process.env.NODE_ENV === \"test\") console.log('Subscriptions.insert[error]', error);\n        Bert.alert(error.reason, 'danger');\n      }\n      if (result) {\n        HipaaLogger.logEvent({eventType: \"delete\", userId: Meteor.userId(), userName: Meteor.user().fullName(), collectionName: \"Subscriptions\", recordId: Session.get('selectedSubscription')});\n        // Session.set('subscriptionUpdate', defaultSubscription);\n        Session.set('subscriptionUpsert', false);\n        Session.set('subscriptionPageTabIndex', 1);\n        Session.set('selectedSubscription', false);\n        Bert.alert('Subscription removed!', 'success');\n      }\n    });\n  }\n}\n\n\nReactMixin(SubscriptionDetail.prototype, ReactMeteorData);\n","import Avatar from 'material-ui/Avatar';\nimport FlatButton from 'material-ui/FlatButton';\nimport { HTTP } from 'meteor/http';\nimport React from 'react';\nimport { ReactMeteorData } from 'meteor/react-meteor-data';\nimport ReactMixin from 'react-mixin';\nimport { Table } from 'react-bootstrap';\n\n//import { Subscriptions } from '../../lib/Subscriptions';\nimport { Session } from 'meteor/session';\nimport { has, get } from 'lodash';\nimport { TableNoData } from 'meteor/clinical:glass-ui';\n\nexport class SubscriptionTable extends React.Component {\n  getMeteorData() {\n    let data = {\n      style: {\n        hideOnPhone: {\n          visibility: 'visible',\n          display: 'table'\n        },\n        cellHideOnPhone: {\n          visibility: 'visible',\n          display: 'table',\n          paddingTop: '16px'\n        },\n        cell: {\n          paddingTop: '16px'\n        }\n      },\n      selected: [],\n      subscriptions: []\n    };\n\n    let query = {};\n    if(this.props.patient){\n      query['patient.display'] = this.props.patient;\n    }\n\n    let options = {};\n    // number of items in the table should be set globally\n    if (get(Meteor, 'settings.public.defaults.paginationLimit')) {\n      options.limit = get(Meteor, 'settings.public.defaults.paginationLimit');\n    }\n\n    // but can be over-ridden by props being more explicit\n    if(this.props.limit){\n      options.limit = this.props.limit;      \n    }\n\n    // data.subscriptions = [];\n    data.subscriptions = Subscriptions.find(query, options).map(function(document){\n      let result = {\n        _id: document._id,\n        status: get(document, 'status', ''),\n        criteria: get(document, 'criteria', ''),\n        type: get(document, 'channel.type', ''),\n        endpoint: get(document, 'channel.endpoint', ''),\n        payload: get(document, 'channel.payload', ''),\n        options: JSON.stringify(get(document, 'channel.options', ''))\n      };\n      return result;\n    });\n\n    // console.log(\"SubscriptionTable[data]\", data);\n    return data;\n  }\n  rowClick(id){\n    Session.set('subscriptionsUpsert', false);\n    Session.set('selectedSubscription', id);\n    Session.set('subscriptionPageTabIndex', 2);\n  }\n  render () {\n    let tableRows = [];\n    let footer;\n\n    if(this.data.subscriptions.length === 0){\n      // don't try to simplifiy the double negative in this expression\n      // it's handling a boolean property, and also serving up instructions/help/warning\n      // it's klunky to reason through; but it's not hurting anything\n      if(!(this.props.noDataMessage === false)){\n        footer = <TableNoData />\n      }\n    } else {\n      for (var i = 0; i < this.data.subscriptions.length; i++) {\n        tableRows.push(\n          <tr key={i} className=\"subscriptionRow\" style={{cursor: \"pointer\"}}>\n  \n            <td className='status' onClick={ this.rowClick.bind('this', this.data.subscriptions[i]._id)} style={this.data.style.cell}>{this.data.subscriptions[i].status}</td>\n            <td className='criteria' onClick={ this.rowClick.bind('this', this.data.subscriptions[i]._id)} style={this.data.style.cell}>{this.data.subscriptions[i].criteria}</td>\n            <td className='type' onClick={ this.rowClick.bind('this', this.data.subscriptions[i]._id)} style={this.data.style.cell}>{this.data.subscriptions[i].type}</td>\n            <td className='endpoint' onClick={ this.rowClick.bind('this', this.data.subscriptions[i]._id)} style={this.data.style.cell}>{this.data.subscriptions[i].endpoint}</td>\n            <td className='payload' onClick={ this.rowClick.bind('this', this.data.subscriptions[i]._id)} style={this.data.style.cell}>{this.data.subscriptions[i].payload}</td>\n            <td className='options' onClick={ this.rowClick.bind('this', this.data.subscriptions[i]._id)} style={this.data.style.cell}>{this.data.subscriptions[i].options}</td>\n          </tr>\n        );\n      }  \n    }\n\n    return(\n      <div>\n        <Table id='subscriptionsTable' hover >\n        <thead>\n          <tr>\n            <th className='status'>status</th>\n            <th className='criteria'>criteria</th>\n            <th className='type'>type</th>\n            <th className='endpoint'>endpoint</th>\n            <th className='payload'>payload</th>\n            <th className='options'>options</th>\n          </tr>\n        </thead>\n        <tbody>\n          { tableRows }\n        </tbody>\n      </Table>\n      { footer }\n      </div>\n    );\n  }\n}\n\n\nReactMixin(SubscriptionTable.prototype, ReactMeteorData);\nexport default SubscriptionTable;","import { CardText, CardTitle } from 'material-ui/Card';\nimport { Tab, Tabs } from 'material-ui/Tabs';\nimport { GlassCard, Glass, VerticalCanvas, FullPageCanvas } from 'meteor/clinical:glass-ui';\n\nimport SubscriptionDetail from './SubscriptionDetail';\nimport SubscriptionTable from './SubscriptionTable';\nimport React from 'react';\nimport { ReactMeteorData } from 'meteor/react-meteor-data';\nimport ReactMixin from 'react-mixin';\n\nimport { Session } from 'meteor/session';\n\nlet defaultSubscription = {\n  index: 2,\n  id: '',\n  username: '',\n  email: '',\n  given: '',\n  family: '',\n  gender: ''\n};\nSession.setDefault('subscriptionFormData', defaultSubscription);\nSession.setDefault('subscriptionSearchFilter', '');\n\nexport class SubscriptionsPage extends React.Component {\n  getMeteorData() {\n    let data = {\n      style: {\n        opacity: Session.get('globalOpacity'),\n        tab: {\n          borderBottom: '1px solid lightgray',\n          borderRight: 'none'\n        }\n      },\n      tabIndex: Session.get('subscriptionPageTabIndex'),\n      subscription: defaultSubscription,\n      subscriptionSearchFilter: '',\n      currentSubscription: null\n    };\n\n    if (Session.get('subscriptionFormData')) {\n      data.subscription = Session.get('subscriptionFormData');\n    }\n    if (Session.get('subscriptionSearchFilter')) {\n      data.subscriptionSearchFilter = Session.get('subscriptionSearchFilter');\n    }\n    if (Session.get(\"selectedSubscription\")) {\n      data.currentSubscription = Session.get(\"selectedSubscription\");\n    }\n\n    data.style = Glass.blur(data.style);\n    data.style.appbar = Glass.darkroom(data.style.appbar);\n    data.style.tab = Glass.darkroom(data.style.tab);\n\n    if(process.env.NODE_ENV === \"test\") console.log(\"SubscriptionsPage[data]\", data);\n    return data;\n  }\n\n  handleTabChange(index){\n    Session.set('subscriptionPageTabIndex', index);\n  }\n\n  onNewTab(){\n    Session.set('selectedSubscription', false);\n    Session.set('subscriptionUpsert', false);\n  }\n\n  render() {\n    console.log('React.version: ' + React.version);\n    return (\n      <div id=\"subscriptionsPage\">\n        <FullPageCanvas>\n          <GlassCard height=\"auto\">\n            <CardTitle\n              title=\"Subscriptions\"\n            />\n            <CardText>\n              {/* <Tabs id='subscriptionsPageTabs' default value={this.data.tabIndex} onChange={this.handleTabChange} initialSelectedIndex={1}>\n                 <Tab className=\"newSubscriptionTab\" label='New' style={this.data.style.tab} onActive={ this.onNewTab } value={0}>\n                   <SubscriptionDetail id='newSubscription' />\n                 </Tab>\n                 <Tab className=\"subscriptionListTab\" label='Subscriptions' onActive={this.handleActive} style={this.data.style.tab} value={1}>\n                   <SubscriptionTable showBarcodes={true} />\n                 </Tab>\n                 <Tab className=\"subscriptionDetailTab\" label='Detail' onActive={this.handleActive} style={this.data.style.tab} value={2}>\n                   <SubscriptionDetail id='subscriptionDetails' currentSubscription={this.data.currentSubscription} />\n                 </Tab>\n             </Tabs> */}\n\n            <SubscriptionTable showBarcodes={true} />\n\n            </CardText>\n          </GlassCard>\n        </FullPageCanvas>\n      </div>\n    );\n  }\n}\n\n\n\nReactMixin(SubscriptionsPage.prototype, ReactMeteorData);\n\nexport default SubscriptionsPage;"]}