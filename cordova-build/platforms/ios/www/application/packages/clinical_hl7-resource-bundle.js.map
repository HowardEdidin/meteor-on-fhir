{"version":3,"sources":["meteor://ðŸ’»app/packages/clinical:hl7-resource-bundle/lib/hl7-resource-bundle.js"],"names":["SimpleSchema","module","link","v","SignatureSchema","Bundle","BaseModel","extend","prototype","_collection","Bundles","Mongo","Collection","_transform","document","BundleSchema","type","String","defaultValue","optional","Code","allowedValues","Number","Array","Object","Date","BaseSchema","DomainResourceSchema","attachSchema","generate","data","bundle","resourceType","entry","forEach","resource","resourceUrl","Meteor","absoluteUrl","_id","id","_document","push","fullUrl","total","length","exportDefault"],"mappings":"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","file":"/packages/clinical_hl7-resource-bundle.js","sourcesContent":["import SimpleSchema from 'simpl-schema';\nimport SignatureSchema from 'meteor/clinical:hl7-resource-datatypes';\n\n// create the object using our BaseModel\nBundle = BaseModel.extend();\n\n\n//Assign a collection so the object knows how to perform CRUD operations\nBundle.prototype._collection = Bundles;\n\n// Create a persistent data store for addresses to be stored.\n// HL7.Resources.Patients = new Mongo.Collection('HL7.Resources.Patients');\nBundles = new Mongo.Collection('Bundles');\n\n//Add the transform to the collection since Meteor.users is pre-defined by the accounts package\nBundles._transform = function (document) {\n  return new Bundle(document);\n};\n\n\n// if (Meteor.isClient){\n//   Meteor.subscribe(\"Bundles\");\n// }\n\n// if (Meteor.isServer){\n//   Meteor.publish(\"Bundles\", function (argument){\n//     if (this.userId) {\n//       return Bundles.find();\n//     } else {\n//       return [];\n//     }\n//   });\n// }\n\n\n\nBundleSchema = new SimpleSchema({\n  \"resourceType\" : {\n    type: String,\n    defaultValue: \"Bundle\"\n  },\n  \"type\" : {\n    optional: true,\n    type: Code,\n    allowedValues: [  'document' , 'message' , 'transaction' , 'transaction-response' , 'batch' , 'batch-response' , 'history' , 'searchset' , 'collection' ],\n    defaultValue: 'searchset'\n  },\n  \"total\" : {\n    optional: true,\n    type: Number\n  },\n  \"link\" : {\n    optional: true,\n    type: Array\n  },\n  \"link.$\" : {\n    optional: true,\n    type: Object\n  },\n  \"link.$.relation\" : {\n    optional: true,\n    type: String\n  },\n  \"link.$.url\" : {\n    optional: true,\n    type: String\n  },\n\n  \"entry\" : {\n    optional: true,\n    type: Array\n  },\n  \"entry.$\" : {\n    optional: true,\n    type: Object\n  },\n\n  \"entry.$.link\" : {\n    optional: true,\n    type: Array\n  },\n  \"entry.$.link.$\" : {\n    optional: true,\n    type: String \n  },  \n  \"entry.$.fullUrl\" : {\n    optional: true,\n    type: String\n  },\n  \"entry.$.resource\" : {\n    optional: true,\n    type: Object\n  },\n\n  \"entry.$.search\" : {\n    optional: true,\n    type: Object\n  },\n\n  \"entry.$.search.mode\" : {\n    optional: true,\n    type: String\n  },\n  \"entry.$.search.score\" : {\n    optional: true,\n    type: Number\n  },\n\n  \"entry.$.request\" : {\n    optional: true,\n    type: Object\n  },\n\n  \"entry.$.request.method\" : {\n    optional: true,\n    type: String\n  },\n  \"entry.$.request.url\" : {\n    optional: true,\n    type: String\n  },\n  \"entry.$.request.ifNoneMatch\" : {\n    optional: true,\n    type: String\n  },\n  \"entry.$.request.ifModifiedSince\" : {\n    optional: true,\n    type: Date\n  },\n  \"entry.$.request.ifMatch\" : {\n    optional: true,\n    type: String\n  },\n  \"entry.$.request.ifNoneExist\" : {\n    optional: true,\n    type: String\n  },\n  \"entry.$.response\" : {\n    optional: true,\n    type: Object\n  },\n  \"entry.$.response.status\" : {\n    optional: true,\n    type: String\n  },\n  \"entry.$.response.location\" : {\n    optional: true,\n    type: String\n  },\n  \"entry.$.response.etag\" : {\n    optional: true,\n    type: String\n  },\n  \"entry.$.response.lastModified\" : {\n    optional: true,\n    type: Date\n  },\n  \"signature\" : {\n    optional: true,\n    type: SignatureSchema\n  }\n});\n\nBaseSchema.extend(BundleSchema);\nDomainResourceSchema.extend(BundleSchema);\nBundles.attachSchema(BundleSchema);\n\n\nBundle.generate = function(data, type){\n  var bundle = {\n    resourceType: \"Bundle\",\n    type: 'searchset',\n    entry: []\n  };\n\n  if (type) {\n    bundle.type = type;\n  }\n\n  // we may want to check whether the data is an array or object\n  // and whether we need to push the object into the array\n  // for now, we're assuming the data is coming in as an array\n  if (data) {\n    data.forEach(function(resource){\n      var resourceUrl = Meteor.absoluteUrl() + 'fhir-3.0.0/' + resource.resourceType + \"/\" + resource._id;\n\n      resource.id = resource._id;\n\n      //delete resource.resourceType;\n      delete resource._document;\n      delete resource._id;\n\n      bundle.entry.push({\n        fullUrl: resourceUrl,\n        resource: resource\n      });\n    });\n\n    bundle.total = data.length;\n  }\n\n  return bundle;\n};\n\nexport default { Bundle, Bundles, BundleSchema };"]}