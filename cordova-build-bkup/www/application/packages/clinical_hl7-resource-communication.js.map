{"version":3,"sources":["meteor://ðŸ’»app/packages/clinical:hl7-resource-communication/lib/Communications.js","meteor://ðŸ’»app/packages/clinical:hl7-resource-communication/lib/meteor.methods.js","meteor://ðŸ’»app/packages/clinical:hl7-resource-communication/index.jsx","meteor://ðŸ’»app/packages/clinical:hl7-resource-communication/client/CommunicationDetail.jsx","meteor://ðŸ’»app/packages/clinical:hl7-resource-communication/client/CommunicationTable.jsx","meteor://ðŸ’»app/packages/clinical:hl7-resource-communication/client/CommunicationsPage.jsx"],"names":["module","export","Communication","Communications","CommunicationStu3","CommunicationR4","CommunicationSchema","SimpleSchema","link","v","Package","console","log","BaseModel","extend","prototype","_collection","Mongo","Collection","_transform","document","type","String","defaultValue","optional","Array","IdentifierSchema","ReferenceSchema","Code","Boolean","CodeableConceptSchema","Date","Object","AttachmentSchema","AnnotationSchema","BaseSchema","DomainResourceSchema","attachSchema","toFhir","EJSON","stringify","name","findCommunicationsSentByUserId","userId","process","env","TRACE","find","findCommunicationsSentToUserId","findConversation","conversationId","sort","fetchBundle","query","parameters","callback","communicationArray","map","communication","id","_id","_document","result","Bundle","generate","insertUnique","record","findOne","collectionConfig","Meteor","isClient","validate","filter","communicationId","insert","methods","createCommunication","communicationObject","check","DEBUG","error","HipaaLogger","logEvent","eventType","userName","user","fullName","collectionName","initializeCommunication","count","defaultCommunication","call","forEach","message","remove","SidebarElements","DynamicRoutes","CommunicationsPage","CommunicationTable","CommunicationDstu2","CommunicationDetail","get","Bert","React","ReactMeteorData","ReactMixin","CardActions","CardText","Card","TextField","RaisedButton","Grid","Row","Col","Table","Session","url","setDefault","getMeteorData","data","selectedCommunication","birthDate","moment","add","format","NODE_ENV","render","props","changeState","bind","padding","marginBottom","field","event","value","communicationUpdate","text","gender","toLowerCase","photo","identifier","set","handleSaveButton","resourceType","update","$set","alert","reason","recordId","handleCancelButton","handleDeleteButton","Component","exportDefault","Avatar","FlatButton","HTTP","style","hideOnPhone","visibility","display","cellHideOnPhone","paddingTop","cell","avatar","backgroundColor","userSelect","borderRadius","height","width","selected","communications","options","limit","subject","subjectReference","recipient","telecom","sent","received","category","payload","status","telecomString","split","rowClick","onSend","httpEndpoint","post","sendCommunication","tableRows","i","length","sendButton","marginTop","push","cursor","minWidth","CardTitle","Tab","Tabs","Glass","GlassCard","FullPageCanvas","DynamicSpacer","index","username","email","given","family","opacity","tab","borderBottom","borderRight","tabIndex","communicationSearchFilter","currentCommunication","blur","appbar","darkroom","handleTabChange","onNewTab","margin"],"mappings":"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","file":"/packages/clinical_hl7-resource-communication.js","sourcesContent":["import SimpleSchema from 'simpl-schema';\n\nif(Package['clinical:autopublish']){\n  console.log(\"*****************************************************************************\")\n  console.log(\"HIPAA WARNING:  Your app has the 'clinical-autopublish' package installed.\");\n  console.log(\"Any protected health information (PHI) stored in this app should be audited.\"); \n  console.log(\"Please consider writing secure publish/subscribe functions and uninstalling.\");  \n  console.log(\"\");  \n  console.log(\"meteor remove clinical:autopublish\");  \n  console.log(\"\");  \n}\nif(Package['autopublish']){\n  console.log(\"*****************************************************************************\")\n  console.log(\"HIPAA WARNING:  DO NOT STORE PROTECTED HEALTH INFORMATION IN THIS APP. \");  \n  console.log(\"Your application has the 'autopublish' package installed.  Please uninstall.\");\n  console.log(\"\");  \n  console.log(\"meteor remove autopublish\");  \n  console.log(\"meteor add clinical:autopublish\");  \n  console.log(\"\");  \n}\n\n\n\n\n\n\n\n/**\n * @summary Represents a Communication; typically documented by a clinician.  A Clinical Impression can be self-assigned, in which case it may be considered a Status or ReportedCondition.\n * @class Communication\n * @param {Object} document An object representing an impression, ususally a Mongo document.\n * @example\nnewCommunication = new Communication({\n  name: {\n    given: \"Jane\",\n    family: \"Doe\"\n  },\n  gender: \"female\",\n  identifier: \"12345\"\n});\n\n\nnewCommunication.clean();\nnewCommunication.validate();\nnewCommunication.save();\n */\n\n\n// create the object using our BaseModel\nCommunication = BaseModel.extend();\n\n\n//Assign a collection so the object knows how to perform CRUD operations\nCommunication.prototype._collection = Communications;\n\n// Create a persistent data store for addresses to be stored.\n// HL7.Resources.Communications = new Mongo.Collection('HL7.Resources.Communications');\nif(typeof Communications === 'undefined'){\n  // if(Package['clinical:autopublish']){\n  //   Communications = new Mongo.Collection('Communications');\n  // } else if(Package['clinical:desktop-publish']){\n  //   Communications = new Mongo.Collection('Communications');\n  // } else {\n  //   Communications = new Mongo.Collection('Communications', {connection: null});\n  // }\n  Communications = new Mongo.Collection('Communications');\n}\n\n//Add the transform to the collection since Meteor.users is pre-defined by the accounts package\nCommunications._transform = function (document) {\n  return new Communication(document);\n};\n\n\n\n\n\n\n\nCommunicationR4 = new SimpleSchema({\n  \"resourceType\" : {\n    type: String,\n    defaultValue: \"Communication\"\n  },\n  \"_id\" : {\n    optional: true,\n    type: String\n    },\n  \"id\" : {\n    optional: true,\n    type: String\n    },\n  \n  \"identifier\" : {\n    optional: true,\n    type:  Array\n    },\n  \"identifier.$\" : {\n    optional: true,\n    type:  IdentifierSchema \n    },\n  \"definition\" : {\n    optional: true,\n    type: Array\n  },\n  \"definition.$\" : {\n    optional: true,\n    type: ReferenceSchema \n  },  \n  \"basedOn\" : {\n    optional: true,\n    type: Array\n  }, \n  \"basedOn.$\" : {\n    optional: true,\n    type: ReferenceSchema\n  }, \n  \"partOf\" : {\n    optional: true,\n    type: Array\n  }, \n  \"partOf.$\" : {\n    optional: true,\n    type: ReferenceSchema\n  }, \n  \"status\" : {\n    optional: false,\n    type: Code\n  }, // R!  registered | partial | final | corrected | appended | cancelled | entered-in-error\n  \"notDone\" : {\n    type: Boolean,\n    optional: true,\n    defaultValue: false\n  },\n  \"notDoneReason\" : {\n    optional: true,\n    type: CodeableConceptSchema\n  },\n  \"category\" : {\n    optional: true,\n    type: Array\n  }, \n  \"category.$\" : {\n    optional: true,\n    type: CodeableConceptSchema \n  }, \n  \"medium\" : {\n    optional: true,\n    type: Array\n  },\n  \"medium.$\" : {\n    optional: true,\n    type: CodeableConceptSchema \n  },  \n  \"subject\" : {\n    optional: true,\n    type: ReferenceSchema\n  }, // R!  The subject of the communication\n  \"recipient\" : {\n    optional: true,\n    type: Array\n  }, \n  \"recipient.$\" : {\n    optional: true,\n    type: ReferenceSchema \n  },   \n  \"topic\" : {\n    optional: true,\n    type: Array\n  }, \n  \"topic.$\" : {\n    optional: true,\n    type: ReferenceSchema \n  },   \n  \"context\" : {\n    optional: true,\n    type: ReferenceSchema\n  }, \n  \"sent\" : {\n    optional: true,\n    type: Date\n  },\n  \"received\" : {\n    optional: true,\n    type: Date\n  },\n  \"sender\" : {\n    optional: true,\n    type: ReferenceSchema\n  },\n  \"reasonCode\" : {\n    optional: true,\n    type: Array\n  }, \n  \"reasonCode.$\" : {\n    optional: true,\n    type: CodeableConceptSchema \n  }, \n  \"reasonReference\" : {\n    optional: true,\n    type: Array\n  }, \n  \"reasonReference.$\" : {\n    optional: true,\n    type: ReferenceSchema \n  },   \n\n  \"payload\" : {\n    optional: true,\n    type: Array\n  },\n  \"payload.$\" : {\n    optional: true,\n    type: Object\n  },\n  \"payload.$.contentString\" : {\n      optional: true,\n      type: String\n  },\n  \"payload.$.contentAttachment\" : {\n    optional: true,\n    type: AttachmentSchema\n  },\n  \"payload.$.contentReference\" : {\n    optional: true,\n    type: ReferenceSchema\n  },\n  \"note\" : {\n    optional: true,\n    type: Array\n  },\n  \"note.$\" : {\n    optional: true,\n    type: AnnotationSchema \n  }\n});\n\n\nCommunicationStu3 = new SimpleSchema({\n  \"resourceType\" : {\n    type: String,\n    defaultValue: \"Communication\"\n  },\n  \"identifier\" : {\n    optional: true,\n    type:  Array\n    },\n  \"identifier.$\" : {\n    optional: true,\n    type:  IdentifierSchema \n    },\n  \"definition\" : {\n    optional: true,\n    type: Array\n  },\n  \"definition.$\" : {\n    optional: true,\n    type: ReferenceSchema \n  },  \n  \"basedOn\" : {\n    optional: true,\n    type: ReferenceSchema\n  }, \n  \"partOf\" : {\n    optional: true,\n    type: ReferenceSchema\n  }, // the conversation\n  \"status\" : {\n    optional: false,\n    type: Code\n  }, // R!  registered | partial | final | corrected | appended | cancelled | entered-in-error\n  \"notDone\" : {\n    type: Boolean,\n    optional: true,\n    defaultValue: false\n  },\n  \"notDoneReason\" : {\n    optional: true,\n    type: CodeableConceptSchema\n  },\n  \"category\" : {\n    optional: true,\n    type: Array\n  }, \n  \"category.$\" : {\n    optional: true,\n    type: CodeableConceptSchema \n  }, \n  \"medium\" : {\n    optional: true,\n    type: Array\n  },\n  \"medium.$\" : {\n    optional: true,\n    type: CodeableConceptSchema \n  },  \n  \"subject\" : {\n    optional: true,\n    type: ReferenceSchema\n  }, // R!  The subject of the communication\n  \"recipient\" : {\n    optional: true,\n    type: Array\n  }, \n  \"recipient.$\" : {\n    optional: true,\n    type: ReferenceSchema \n  },   \n  \"topic\" : {\n    optional: true,\n    type: Array\n  }, \n  \"topic.$\" : {\n    optional: true,\n    type: ReferenceSchema \n  },   \n  \"context\" : {\n    optional: true,\n    type: ReferenceSchema\n  }, \n  \"sent\" : {\n    optional: true,\n    type: Date\n  },\n  \"received\" : {\n    optional: true,\n    type: Date\n  },\n  \"sender\" : {\n    optional: true,\n    type: ReferenceSchema\n  },\n  \"reasonCode\" : {\n    optional: true,\n    type: Array\n  }, \n  \"reasonCode.$\" : {\n    optional: true,\n    type: CodeableConceptSchema \n  }, \n  \"reasonReference\" : {\n    optional: true,\n    type: Array\n  }, \n  \"reasonReference.$\" : {\n    optional: true,\n    type: ReferenceSchema \n  },   \n\n  \"payload\" : {\n    optional: true,\n    type: Array\n  },\n  \"payload.$\" : {\n    optional: true,\n    type: Object\n  },\n  \"payload.$.contentString\" : {\n      optional: true,\n      type: String\n  },\n  \"payload.$.contentAttachment\" : {\n    optional: true,\n    type: AttachmentSchema\n  },\n  \"payload.$.contentReference\" : {\n    optional: true,\n    type: ReferenceSchema\n  },\n  \"note\" : {\n    optional: true,\n    type: Array\n  },\n  \"note.$\" : {\n    optional: true,\n    type: AnnotationSchema \n  }\n});\n\nBaseSchema.extend(CommunicationR4);\nDomainResourceSchema.extend(CommunicationR4);\n\nCommunications.attachSchema(CommunicationR4);\n\n\nCommunication.prototype.toFhir = function(){\n  console.log('Communication.toFhir()');\n\n  return EJSON.stringify(this.name);\n}\n\n/**\n * @summary Search the Communications collection for those sent by a specific userId.\n * @memberOf Communications\n * @name findCommunicationsSentByUserId\n * @version 1.2.3\n * @returns array of communications\n * @example\n * ```js\n *  let communications = Communications.findCommunicationsSentByUserId(Meteor.userId());\n *  let communication = communications[0];\n * ```\n */\n\nCommunications.findCommunicationsSentByUserId = function (userId) {\n  process.env.TRACE && console.log(\"Communications.findCommunicationsSentByUserId()\");\n  return Communications.find({'sender.value': userId});\n};\n\n/**\n * @summary Search the Communications collection for those sent by a specific userId.\n * @memberOf Communications\n * @name findCommunicationsSentToUserId\n * @version 1.2.3\n * @returns array of communications\n * @example\n * ```js\n *  let communications = Communications.findCommunicationsSentByUserId(Meteor.userId());\n *  let communication = communications[0];\n * ```\n */\nCommunications.findCommunicationsSentToUserId = function (userId) {\n  process.env.TRACE && console.log(\"Communications.findCommunicationsSentToUserId()\");\n  return Communications.find({'recipient.value': userId});\n};\n\n\n/**\n * @summary Search the Communications collection for a specific Meteor.userId().\n * @memberOf Communications\n * @name findMrn\n * @version 1.2.3\n * @returns {Boolean}\n * @example\n * ```js\n *  let communications = Communications.findMrn('12345').fetch();\n * ```\n */\nCommunications.findConversation = function (conversationId, sort=1) {\n  process.env.TRACE && console.log(\"Communications.findMrn()\");  \n  return Communications.find(\n    { 'partOf.identifier.value': conversationId}, \n    { 'sort': { 'received': sort } });\n};\n\n/**\n * @summary Search the Communications collection for a specific query.\n * @memberOf Communications\n */\n\nCommunications.fetchBundle = function (query, parameters, callback) {\n  process.env.TRACE && console.log(\"Communications.fetchBundle()\");  \n  var communicationArray = Communications.find(query, parameters, callback).map(function(communication){\n    communication.id = communication._id;\n    delete communication._document;\n    return communication;\n  });\n\n  // console.log(\"communicationArray\", communicationArray);\n\n  var result = Bundle.generate(communicationArray);\n\n  // console.log(\"result\", result.entry[0]);\n\n  return result;\n};\n\n\n\n\n// Communications.prototype.insertUnique = function(record){\n//   console.log('Communications.prototype.insertUnique');\n\n//   if(Communications.findConversation(record._id)){\n//     Communications.insert(record)    \n//   }\n// }\n\nCommunications.insertUnique = function (record) {\n  console.log(\"Communications.insertUnique()\");\n  console.log(\"Communications.findOne(record._id)\", Communications.findOne(record._id));\n\n  if(!Communications.findOne(record._id)){\n    let collectionConfig = {};\n    if(Meteor.isClient){\n      collectionConfig = { validate: false, filter: false }\n    }\n    let communicationId = Communications.insert(record, collectionConfig);    \n    console.log('Communication created: ' + communicationId);\n    return communicationId;\n  }\n};\n\nCommunicationSchema = CommunicationR4;\n\nexport { Communication, Communications, CommunicationStu3, CommunicationR4, CommunicationSchema };","\n\nMeteor.methods({\n  createCommunication:function(communicationObject){\n    check(communicationObject, Object);\n\n    //if (process.env.NODE_ENV === 'test') {\n      process.env.DEBUG && console.log('-----------------------------------------');\n      process.env.DEBUG && console.log('Creating Communication...');\n      Communications.insert(communicationObject, function(error, result){\n        if (error) {\n          console.log(error);\n          if (typeof HipaaLogger === 'object') {\n            HipaaLogger.logEvent({\n              eventType: \"error\",\n              userId: Meteor.userId(),\n              userName: Meteor.user().fullName(),\n              collectionName: \"Communications\"\n            });\n          }\n        }\n        if (result) {\n          console.log('Communication created: ' + result);\n          if (typeof HipaaLogger === 'object') {\n            HipaaLogger.logEvent({\n              eventType: \"create\",\n              userId: Meteor.userId(),\n              userName: Meteor.user().fullName(),\n              collectionName: \"Communications\"\n            });\n          }\n        }\n      });\n    // } else {\n    //   console.log('This command can only be run in a test environment.');\n    //   console.log('Try setting NODE_ENV=test');\n    // }\n  },\n  initializeCommunication:function(){\n    if (Communications.find().count() === 0) {\n      console.log('-----------------------------------------');\n      console.log('No records found in Communications collection.  Lets create some...');\n\n      var defaultCommunication = {\n        \"resourceType\": \"Communication\",\n        \"id\": \"example\",\n        \"text\": {\n          \"status\": \"generated\",\n          \"div\": \"<div xmlns=\\\"http://www.w3.org/1999/xhtml\\\">Blank Communication</div>\"\n        },\n        \"identifier\": [\n          {\n            \"type\": {\n              \"text\": \"Paging System\"\n            },\n            \"system\": \"urn:oid:1.3.4.5.6.7\",\n            \"value\": \"2345678901\"\n          }\n        ],\n        \"definition\": [\n          {\n            \"display\": \"Hyperkalemia\"\n          }\n        ],\n        \"partOf\": {\n            \"display\": \"Serum Potassium Observation\"\n        },\n        \"status\": \"completed\",\n        \"category\": [\n          {\n            \"coding\": [\n              {\n                \"system\": \"http://acme.org/messagetypes\",\n                \"code\": \"Alert\"\n              }\n            ],\n            \"text\": \"Alert\"\n          }\n        ],\n        \"medium\": [\n          {\n            \"coding\": [\n              {\n                \"system\": \"http://hl7.org/fhir/v3/ParticipationMode\",\n                \"code\": \"WRITTEN\",\n                \"display\": \"written\"\n              }\n            ],\n            \"text\": \"written\"\n          }\n        ],\n        \"subject\": {\n          \"reference\": \"Practitioner/cuddy\"\n        },\n        \"recipient\": [\n          {\n            \"reference\": \"Practitioner/house\"\n          }\n        ],\n        \"context\": {\n          \"reference\": \"Encounter/example\"\n        },\n        \"sent\": \"2014-12-12T18:01:10-08:00\",\n        \"received\": \"2014-12-12T18:01:11-08:00\",\n        \"sender\": {\n          \"reference\": \"Device/f001\"\n        },\n        \"payload\": [\n          {\n            \"contentString\": \"Patient 1 has a very high serum potassium value (7.2 mmol/L on 2014-Dec-12 at 5:55 pm)\"\n          },\n          {\n            \"contentReference\": {\n              \"display\": \"Serum Potassium Observation\"\n            }\n          }\n        ]\n      };\n\n      Meteor.call('createCommunication', defaultCommunication);\n    } else {\n      console.log('Communications already exist.  Skipping.');\n    }\n  },\n  'Communications/drop': function(){\n    console.log('Removing all records from Communications cursor.');\n\n    Communications._collection.find().forEach(function(message){\n      Communications._collection.remove({_id: message._id});\n    })\n    Communications.find().forEach(function(message){\n      Communications.remove({_id: message._id});\n    })\n\n  }\n});\n","\n\n\nimport CommunicationsPage from './client/CommunicationsPage';\nimport CommunicationTable from './client/CommunicationTable';\n\nimport { Communication, Communications, CommunicationSchema, CommunicationDstu2, CommunicationStu3 } from './lib/Communications';\n\n\nvar DynamicRoutes = [{\n  'name': 'CommunicationPage',\n  'path': '/communications',\n  'component': CommunicationsPage,\n  'requireAuth': true\n}];\n\nvar SidebarElements = [{\n  'primaryText': 'Communications',\n  'to': '/communications',\n  'href': '/communications'\n}];\n\nexport { \n  SidebarElements, \n  DynamicRoutes, \n\n  CommunicationsPage,\n  CommunicationTable,\n  \n  Communication,\n  Communications,\n  CommunicationSchema,\n  CommunicationDstu2, \n  CommunicationStu3\n};\n\n\n","import { get } from 'lodash';\n\nimport { Bert } from 'meteor/clinical:alert';\nimport React from 'react';\nimport { ReactMeteorData } from 'meteor/react-meteor-data';\nimport ReactMixin from 'react-mixin';\nimport { CardActions, CardText, Card, TextField, RaisedButton } from 'material-ui';\nimport { Grid, Row, Col, Table } from 'react-bootstrap';\n\nimport { Session } from 'meteor/session';\n\n\nlet defaultCommunication = {\n  \"resourceType\" : \"Communication\",\n  \"name\" : [{\n    \"text\" : \"\",\n    \"resourceType\" : \"HumanName\"\n  }],\n  \"active\" : true,\n  \"gender\" : \"\",\n  \"birthDate\" : null,\n  \"photo\" : [{\n    url: \"\"\n  }],\n  \"identifier\": [{\n    \"use\": \"usual\",\n    \"type\": {\n      \"coding\": [\n        {\n          \"system\": \"http://hl7.org/fhir/v2/0203\",\n          \"code\": \"MR\"\n        }\n      ]\n    },\n    \"value\": \"\"\n  }],\n  \"test\" : false\n};\n\n\nSession.setDefault('communicationUpsert', false);\nSession.setDefault('selectedCommunication', false);\n\nexport class CommunicationDetail extends React.Component {\n  getMeteorData() {\n    let data = {\n      communicationId: false,\n      communication: defaultCommunication\n    };\n\n    if (Session.get('communicationUpsert')) {\n      data.communication = Session.get('communicationUpsert');\n    } else {\n      if (Session.get('selectedCommunication')) {\n        data.communicationId = Session.get('selectedCommunication');\n        console.log(\"selectedCommunication\", Session.get('selectedCommunication'));\n\n        let selectedCommunication = Communications.findOne({_id: Session.get('selectedCommunication')});\n        console.log(\"selectedCommunication\", selectedCommunication);\n\n        if (selectedCommunication) {\n          data.communication = selectedCommunication;\n\n          if (typeof selectedCommunication.birthDate === \"object\") {\n            data.communication.birthDate = moment(selectedCommunication.birthDate).add(1, 'day').format(\"YYYY-MM-DD\");\n          }\n        }\n      } else {\n        data.communication = defaultCommunication;\n      }\n    }\n\n    if(process.env.NODE_ENV === \"test\") console.log(\"CommunicationDetail[data]\", data);\n    return data;\n  }\n\n  render() {\n    return (\n      <div id={this.props.id} className=\"communicationDetail\">\n        <CardText>\n            <Row>\n              <Col md={2}>\n                <TextField\n                  id='categoryInput'\n                  name='category'\n                  floatingLabelText='category'\n                  value={ get(this, 'data.communication.category[0].text') }\n                  onChange={ this.changeState.bind(this, 'category')}\n                  fullWidth\n                  /><br/>\n              </Col>\n              <Col md={6}>\n                <TextField\n                  id='identifierInput'\n                  name='identifier'\n                  floatingLabelText='identifier'\n                  value={ get(this, 'data.communication.identifier[0].url') }\n                  onChange={ this.changeState.bind(this, 'photo')}\n                  floatingLabelFixed={false}\n                  fullWidth\n                  /><br/>\n              </Col>\n            </Row>\n            <Row>\n              <Col md={4}>\n                <Card zDepth={2} style={{padding: '20px', marginBottom: '20px'}}>\n                  <TextField\n                    id='subjectInput'\n                    name='subject'\n                    floatingLabelText='subject'\n                    value={ get(this, 'data.communication.subject.display', '') }\n                    onChange={ this.changeState.bind(this, 'name')}\n                    fullWidth\n                    /><br/>\n                  <TextField\n                    id='sentInput'\n                    name='sent'\n                    floatingLabelText='sent'\n                    value={ moment(get(this, 'data.communication.sent')).format('YYYY-MM-DD hh:mm:ss') }\n                    onChange={ this.changeState.bind(this, 'sent')}\n                    fullWidth\n                    /><br/>\n                </Card>\n              </Col>\n              <Col md={4}>\n                <Card zDepth={2} style={{padding: '20px', marginBottom: '20px'}}>\n                  <TextField\n                    id='definitionInput'\n                    name='definition'\n                    floatingLabelText='definition'\n                    value={ get(this, 'data.communication.definition[0].text') }\n                    onChange={ this.changeState.bind(this, 'definition')}\n                    fullWidth\n                    /><br/>\n                  <TextField\n                    id='payloadInput'\n                    name='payload'\n                    floatingLabelText='payload'\n                    value={ get(this, 'data.communication.payload[0].contentString') }\n                    onChange={ this.changeState.bind(this, 'payload')}\n                    fullWidth\n                    /><br/>\n                </Card>\n              \n              </Col>\n              <Col md={4}>\n                <Card zDepth={2} style={{padding: '20px', marginBottom: '20px'}}>\n                  <TextField\n                    id='recipientInput'\n                    name='recipient'\n                    floatingLabelText='recipient'\n                    onChange={ this.changeState.bind(this, 'recipient')}\n                    value={ get(this, 'data.communication.recipient.display', '') }\n                    fullWidth\n                    /><br/>\n                  <TextField\n                    id='receivedInput'\n                    name='received'\n                    floatingLabelText='received'\n                    value={ moment(get(this, 'data.communication.received')).format('YYYY-MM-DD hh:mm:ss') }\n                    onChange={ this.changeState.bind(this, 'received')}\n                    fullWidth\n                    /><br/>\n                </Card>\n                {/* { this.determineButtons(this.data.communicationId) }   */}\n              </Col>\n            </Row>\n\n        </CardText>\n      </div>\n    );\n  }\n  // determineButtons(communicationId){\n  //   if (communicationId) {\n  //     return (\n  //       <div>\n  //         <RaisedButton id='saveCommunicationButton' className='saveCommunicationButton' label=\"Save\" primary={true} onClick={this.handleSaveButton.bind(this)} style={{marginRight: '20px'}} />\n  //         <RaisedButton label=\"Delete\" onClick={this.handleDeleteButton.bind(this)} />\n  //       </div>\n  //     );\n  //   } else {\n  //     return(\n  //         <RaisedButton id='saveCommunicationButton'  className='saveCommunicationButton' label=\"Save\" primary={true} onClick={this.handleSaveButton.bind(this)} />\n  //     );\n  //   }\n  // }\n\n  changeState(field, event, value){\n    let communicationUpdate;\n\n    if(process.env.NODE_ENV === \"test\") console.log(\"communicationDetail.changeState\", field, event, value);\n\n    // by default, assume there's no other data and we're creating a new communication\n    if (Session.get('communicationUpsert')) {\n      communicationUpdate = Session.get('communicationUpsert');\n    } else {\n      communicationUpdate = defaultCommunication;\n    }\n\n\n\n    // if there's an existing communication, use them\n    if (Session.get('selectedCommunication')) {\n      communicationUpdate = this.data.communication;\n    }\n\n    switch (field) {\n      case \"subject\":\n        communicationUpdate.name[0].text = value;\n        break;\n      case \"recipient\":\n        communicationUpdate.gender = value.toLowerCase();\n        break;\n      case \"sent\":\n        communicationUpdate.birthDate = value;\n        break;\n      case \"definition\":\n        communicationUpdate.photo[0].url = value;\n        break;\n      case \"identifier\":\n        communicationUpdate.identifier[0].value = value;\n        break;\n      case \"category\":\n        communicationUpdate.identifier[0].value = value;\n        break;\n        case \"payload\":\n        communicationUpdate.identifier[0].value = value;\n        break;\n      default:\n\n    }\n    // communicationUpdate[field] = value;\n    process.env.TRACE && console.log(\"communicationUpdate\", communicationUpdate);\n\n    Session.set('communicationUpsert', communicationUpdate);\n  }\n\n\n  // this could be a mixin\n  handleSaveButton(){\n    if(process.env.NODE_ENV === \"test\") console.log('handleSaveButton()');\n    let communicationUpdate = Session.get('communicationUpsert', communicationUpdate);\n\n\n    if (communicationUpdate.birthDate) {\n      communicationUpdate.birthDate = new Date(communicationUpdate.birthDate);\n    }\n    if(process.env.NODE_ENV === \"test\") console.log(\"communicationUpdate\", communicationUpdate);\n\n    if (Session.get('selectedCommunication')) {\n      if(process.env.NODE_ENV === \"test\") console.log(\"Updating communication...\");\n\n      delete communicationUpdate._id;\n\n      // not sure why we're having to respecify this; fix for a bug elsewhere\n      communicationUpdate.resourceType = 'Communication';\n\n      Communications.update({_id: Session.get('selectedCommunication')}, {$set: communicationUpdate }, function(error, result){\n        if (error) {\n          if(process.env.NODE_ENV === \"test\") console.log(\"Communications.insert[error]\", error);\n          Bert.alert(error.reason, 'danger');\n        }\n        if (result) {\n          HipaaLogger.logEvent({eventType: \"update\", userId: Meteor.userId(), userName: Meteor.user().fullName(), collectionName: \"Communications\", recordId: Session.get('selectedCommunication')});\n          Session.set('communicationUpdate', defaultCommunication);\n          Session.set('communicationUpsert', defaultCommunication);\n          Session.set('communicationPageTabIndex', 1);\n          Bert.alert('Communication added!', 'success');\n        }\n      });\n    } else {\n      if(process.env.NODE_ENV === \"test\") console.log(\"Creating a new communication...\", communicationUpdate);\n\n      Communications.insert(communicationUpdate, function(error, result) {\n        if (error) {\n          if(process.env.NODE_ENV === \"test\")  console.log('Communications.insert[error]', error);\n          Bert.alert(error.reason, 'danger');\n        }\n        if (result) {\n          HipaaLogger.logEvent({eventType: \"create\", userId: Meteor.userId(), userName: Meteor.user().fullName(), collectionName: \"Communications\", recordId: result});\n          Session.set('communicationPageTabIndex', 1);\n          Session.set('selectedCommunication', false);\n          Session.set('communicationUpsert', false);\n          Bert.alert('Communication added!', 'success');\n        }\n      });\n    }\n  }\n\n  handleCancelButton(){\n    Session.set('communicationPageTabIndex', 1);\n  }\n\n  handleDeleteButton(){\n    Communications.remove({_id: Session.get('selectedCommunication')}, function(error, result){\n      if (error) {\n        if(process.env.NODE_ENV === \"test\") console.log('Communications.insert[error]', error);\n        Bert.alert(error.reason, 'danger');\n      }\n      if (result) {\n        HipaaLogger.logEvent({eventType: \"delete\", userId: Meteor.userId(), userName: Meteor.user().fullName(), collectionName: \"Communications\", recordId: Session.get('selectedCommunication')});\n        Session.set('communicationUpdate', defaultCommunication);\n        Session.set('communicationUpsert', defaultCommunication);\n        Session.set('communicationPageTabIndex', 1);\n        Bert.alert('Communication removed!', 'success');\n      }\n    });\n  }\n}\n\n\nReactMixin(CommunicationDetail.prototype, ReactMeteorData);\n\nexport default CommunicationDetail;","import Avatar from 'material-ui/Avatar';\nimport { FlatButton, RaisedButton } from 'material-ui';\nimport { HTTP } from 'meteor/http';\nimport React from 'react';\nimport { ReactMeteorData } from 'meteor/react-meteor-data';\nimport ReactMixin from 'react-mixin';\nimport { Table } from 'react-bootstrap';\n\nimport { get } from 'lodash';\n// import { Communications } from 'meteor/clinical:hl7-resource-communication';\n\nexport default class CommunicationTable extends React.Component {\n  getMeteorData() {\n    let data = {\n      style: {\n        hideOnPhone: {\n          visibility: 'visible',\n          display: 'table'\n        },\n        cellHideOnPhone: {\n          visibility: 'visible',\n          display: 'table',\n          paddingTop: '16px'\n        },\n        cell: {\n          paddingTop: '16px'\n        },\n        avatar: {\n          backgroundColor: 'rgb(188, 188, 188)',\n          userSelect: 'none',\n          borderRadius: '2px',\n          height: '40px',\n          width: '40px'\n        }\n      },\n      selected: [],\n      communications: []\n    };\n\n    let query = {};\n    let options = {};\n\n    // number of items in the table should be set globally\n    if (get(Meteor, 'settings.public.defaults.paginationLimit')) {\n      options.limit = get(Meteor, 'settings.public.defaults.paginationLimit');\n    }\n\n    // but can be over-ridden by props being more explicit\n    if(this.props.limit){\n      options.limit = this.props.limit;      \n    }\n\n    data.communications = Communications.find(query, options).map(function(communication){\n      let result = {\n        _id: communication._id,\n        subject: '',\n        subjectReference: '',\n        recipient: '',\n        identifier: '',\n        telecom: '',\n        sent: '',\n        received: '',\n        category: '',\n        payload: '',\n        status: ''\n      };\n\n      if(get(communication, 'sent')){\n        result.sent = moment(get(communication, 'sent')).add(1, 'days').format(\"YYYY-MM-DD\")\n      }\n      if(get(communication, 'received')){\n        result.received = moment(get(communication, 'received')).add(1, 'days').format(\"YYYY-MM-DD\")\n      }\n\n      let telecomString = \"\";\n      if(get(communication, 'recipient.reference')){\n        if(get(communication, 'recipient.reference').split(\"/\")[1]){\n          telecomString = get(communication, 'recipient.reference').split(\"/\")[1];\n        }\n      }\n\n\n      result.subject = get(communication, 'subject.display') ? get(communication, 'subject.display') : get(communication, 'subject.reference')\n      result.recipient = get(communication, 'recipient[0].display') ? get(communication, 'recipient[0].display') : get(communication, 'recipient[0].reference')\n      result.identifier = get(communication, 'identifier[0].type.text');\n      result.telecom = get(communication, 'telecom[0].value') ? get(communication, 'telecom[0].value') : telecomString;\n      result.category = get(communication, 'category[0].text');\n      result.payload = get(communication, 'payload[0].contentString');\n      result.status = get(communication, 'status');\n\n      return result;\n    });\n\n    if (Session.get('appWidth') < 768) {\n      data.style.hideOnPhone.visibility = 'hidden';\n      data.style.hideOnPhone.display = 'none';\n      data.style.cellHideOnPhone.visibility = 'hidden';\n      data.style.cellHideOnPhone.display = 'none';\n    } else {\n      data.style.hideOnPhone.visibility = 'visible';\n      data.style.hideOnPhone.display = 'table-cell';\n      data.style.cellHideOnPhone.visibility = 'visible';\n      data.style.cellHideOnPhone.display = 'table-cell';\n    }\n\n    console.log('CommunicationTable.data', data)\n    return data;\n  }\n  rowClick(id){\n    Session.set('communicationsUpsert', false);\n    Session.set('selectedCommunication', id);\n    Session.set('communicationPageTabIndex', 2);\n  }\n  onSend(id){\n      let communication = Communications.findOne({_id: id});\n\n      console.log(\"CommunicationTable.onSend()\", communication);\n\n      var httpEndpoint = \"http://localhost:8080\";\n      if (get(Meteor, 'settings.public.interfaces.default.channel.endpoint')) {\n        httpEndpoint = get(Meteor, 'settings.public.interfaces.default.channel.endpoint');\n      }\n      HTTP.post(httpEndpoint + '/Communication', {\n        data: communication\n      }, function(error, result){\n        if (error) {\n          console.log(\"error\", error);\n        }\n        if (result) {\n          console.log(\"result\", result);\n        }\n      });\n  }\n  sendCommunication(communication){\n    console.log('sendCommunication', communication)\n\n    // TODO:\n\n    switch (get(communication, 'category')) {\n      case 'SMS Text Message':\n        console.log('Sending SMS Text Message', communication.payload, communication.telecom)\n        Meteor.call('sendTwilioMessage', communication.payload, communication.telecom)\n        break;    \n      default:\n        break;\n    }\n  }\n  render () {\n    let tableRows = [];\n    for (var i = 0; i < this.data.communications.length; i++) {\n\n      let sendButton;\n      if(!get(this, 'data.communications[i].sent')){\n        sendButton = <RaisedButton primary={false} label=\"Send\" onClick={ this.sendCommunication.bind(this, this.data.communications[i]) } style={{marginTop: '-16px'}} />\n      } else {\n        sendButton = get(this, 'data.communications[i].sent');\n      }\n      tableRows.push(\n        <tr key={i} className=\"communicationRow\" style={{cursor: \"pointer\"}}>\n          <td className='subject' onClick={ this.rowClick.bind('this', this.data.communications[i]._id)} style={this.data.style.cell}>{this.data.communications[i].subject }</td>\n          <td className='recipient' onClick={ this.rowClick.bind('this', this.data.communications[i]._id)} style={this.data.style.cell}>{this.data.communications[i].recipient }</td>\n          <td className='identifier' onClick={ this.rowClick.bind('this', this.data.communications[i]._id)} style={this.data.style.cell}>{this.data.communications[i].identifier }</td>\n          <td className='telecom' onClick={ this.rowClick.bind('this', this.data.communications[i]._id)} style={this.data.style.cell}>{this.data.communications[i].telecom }</td>\n          <td className='sent' onClick={ this.rowClick.bind('this', this.data.communications[i]._id)} style={this.data.style.cell}>{ sendButton }</td>\n          <td className='received' onClick={ this.rowClick.bind('this', this.data.communications[i]._id)} style={this.data.style.cell}>{this.data.communications[i].received }</td>\n          <td className='category' onClick={ this.rowClick.bind('this', this.data.communications[i]._id)} style={this.data.style.cell}>{this.data.communications[i].category }</td>\n          <td className='payload' onClick={ this.rowClick.bind('this', this.data.communications[i]._id)} style={this.data.style.cell}>{this.data.communications[i].payload }</td>\n          <td className='status' onClick={ this.rowClick.bind('this', this.data.communications[i]._id)} style={this.data.style.cell}>{this.data.communications[i].status }</td>\n        </tr>\n      );\n    }\n\n\n    return(\n      <Table id='communicationsTable' hover >\n        <thead>\n          <tr>\n            <th className='subject'>subject</th>\n            <th className='recipient'>recipient</th>\n            <th className='identifier'>identifier</th>\n            <th className='telecom'>telecom</th>\n            <th className='sent' style={{minWidth: '100px'}}>sent</th>\n            <th className='received' style={{minWidth: '100px'}}>received</th>\n            <th className='category' style={this.data.style.hideOnPhone}>category</th>\n            <th className='payload' style={this.data.style.hideOnPhone}>payload</th>\n            <th className='status' style={this.data.style.hideOnPhone}>status</th>\n          </tr>\n        </thead>\n        <tbody>\n          { tableRows }\n        </tbody>\n      </Table>\n\n    );\n  }\n}\n\n\nReactMixin(CommunicationTable.prototype, ReactMeteorData);\n","import { CardText, CardTitle } from 'material-ui/Card';\nimport { Tab, Tabs } from 'material-ui/Tabs';\n\nimport { Glass, GlassCard, FullPageCanvas, DynamicSpacer } from 'meteor/clinical:glass-ui';\n\nimport CommunicationDetail from './CommunicationDetail';\nimport CommunicationTable from './CommunicationTable';\nimport React from 'react';\nimport { ReactMeteorData } from 'meteor/react-meteor-data';\nimport ReactMixin from 'react-mixin';\n\nimport { Session } from 'meteor/session';\n\n\nlet defaultCommunication = {\n  index: 2,\n  id: '',\n  username: '',\n  email: '',\n  given: '',\n  family: '',\n  gender: ''\n};\nSession.setDefault('communicationFormData', defaultCommunication);\nSession.setDefault('communicationSearchFilter', '');\n\nexport class CommunicationsPage extends React.Component {\n  getMeteorData() {\n    let data = {\n      style: {\n        opacity: Session.get('globalOpacity'),\n        tab: {\n          borderBottom: '1px solid lightgray',\n          borderRight: 'none'\n        }\n      },\n      tabIndex: Session.get('communicationPageTabIndex'),\n      communication: defaultCommunication,\n      communicationSearchFilter: '',\n      currentCommunication: null\n    };\n\n    if (Session.get('communicationFormData')) {\n      data.communication = Session.get('communicationFormData');\n    }\n    if (Session.get('communicationSearchFilter')) {\n      data.communicationSearchFilter = Session.get('communicationSearchFilter');\n    }\n    if (Session.get(\"selectedCommunication\")) {\n      data.currentCommunication = Session.get(\"selectedCommunication\");\n    }\n\n    data.style = Glass.blur(data.style);\n    data.style.appbar = Glass.darkroom(data.style.appbar);\n    data.style.tab = Glass.darkroom(data.style.tab);\n\n    if(process.env.NODE_ENV === \"test\") console.log(\"CommunicationsPage[data]\", data);\n    return data;\n  }\n\n  handleTabChange(index){\n    Session.set('communicationPageTabIndex', index);\n  }\n\n  onNewTab(){\n    Session.set('selectedCommunication', false);\n    Session.set('communicationUpsert', false);\n  }\n\n  render() {\n    return (\n      <div id=\"communicationsPage\">\n        <FullPageCanvas>\n          <CommunicationDetail \n            id='newCommunication' />\n          {/* <DynamicSpacer /> */}\n\n          <GlassCard height=\"auto\" style={{margin: '16px'}}>\n            <CardTitle\n              title=\"Communication Log\"\n            />\n            <CardText>\n              <CommunicationTable showBarcodes={true} />\n            </CardText>\n          </GlassCard>\n        </FullPageCanvas>\n      </div>\n    );\n  }\n}\n\n\n\nReactMixin(CommunicationsPage.prototype, ReactMeteorData);\n\nexport default CommunicationsPage;"]}